% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/est-effort-busroute.R
\name{est_effort.busroute_design}
\alias{est_effort.busroute_design}
\title{Bus-Route Effort Estimation (REBUILT with Native Survey Integration)}
\usage{
est_effort.busroute_design(
  x,
  counts = NULL,
  by = c("date", "location"),
  day_id = "date",
  inclusion_prob_col = "inclusion_prob",
  route_minutes_col = "route_minutes",
  contrib_hours_col = NULL,
  covariates = NULL,
  svy = NULL,
  conf_level = 0.95,
  variance_method = "survey",
  decompose_variance = FALSE,
  design_diagnostics = FALSE,
  n_replicates = 1000,
  ...
)
}
\arguments{
\item{x}{A \code{busroute_design} object.}

\item{counts}{Optional tibble/data.frame of observation data. If \code{x} contains
\verb{$counts}, that will be used by default.}

\item{by}{Character vector of grouping variables to retain in output (e.g.,
\code{date}, \code{location}). Missing columns are ignored with a warning.}

\item{day_id}{Day identifier (PSU), typically \code{date}.}

\item{inclusion_prob_col}{Column name with inclusion probability \code{pi} for each
observed party/vehicle or count segment (default \code{inclusion_prob}).}

\item{route_minutes_col}{Per-visit route minutes column to translate counts
to time (default \code{route_minutes}). Used if \code{contrib_hours_col} is not given.}

\item{contrib_hours_col}{Optional precomputed contribution in hours for each
observed unit (e.g., observed overlap hours). If present, the HT
contribution is \code{contrib_hours / pi}. Otherwise uses \code{count / pi * route_minutes/60}.}

\item{covariates}{Optional character vector of additional grouping variables.}

\item{svy}{Optional \code{svydesign}/\code{svrepdesign} encoding day-level sampling. If
absent, a day-PSU design is constructed from \code{x$calendar} via
\code{as_day_svydesign()}.}

\item{conf_level}{Confidence level for CI (default 0.95).}

\item{variance_method}{\strong{NEW} Variance estimation method:
\describe{
\item{"survey"}{Standard survey package variance (default, backward compatible)}
\item{"svyrecvar"}{survey:::svyrecvar internals for maximum accuracy}
\item{"bootstrap"}{Bootstrap resampling variance}
\item{"jackknife"}{Jackknife resampling variance}
\item{"linearization"}{Taylor linearization (alias for "survey")}
}}

\item{decompose_variance}{\strong{NEW} Logical, whether to decompose variance into
components. Adds variance decomposition to variance_info output. Default FALSE.}

\item{design_diagnostics}{\strong{NEW} Logical, whether to compute design quality
diagnostics. Adds diagnostic information to variance_info output. Default FALSE.}

\item{n_replicates}{\strong{NEW} Number of bootstrap/jackknife replicates (default 1000)}

\item{...}{Reserved for future arguments.}
}
\value{
A tibble with group columns, \code{estimate}, \code{se}, \code{ci_low}, \code{ci_high},
\code{deff} (design effect), \code{n}, \code{method}, \code{diagnostics} list-column, and
\code{variance_info} list-column with comprehensive variance information.
}
\description{
Estimate fishing effort for bus-route designs using a Horvitz–Thompson-style
day×group total and compute design-based totals and variance via the \code{survey}
package with NATIVE support for advanced variance methods.
}
\details{
\strong{NEW}: Native support for multiple variance methods, variance decomposition,
and design diagnostics without requiring wrapper functions.

Computes day × group totals using Horvitz–Thompson contributions and uses
a day-PSU survey design to compute totals/variance via the \code{survey} package.
Replicate-weight designs are supported by passing a \code{svrepdesign}.
}
\examples{
\dontrun{
# BACKWARD COMPATIBLE
result <- est_effort(design, by = c("date", "location"))

# NEW: Advanced features
result <- est_effort(
  design,
  by = c("date", "location"),
  variance_method = "bootstrap",
  decompose_variance = TRUE,
  design_diagnostics = TRUE
)

# Access enhanced information
result$variance_info[[1]]$decomposition
result$variance_info[[1]]$diagnostics
}

}
\references{
Malvestuto, S.P. (1996). Sampling for creel survey data.
In: Murphy, B.R. & Willis, D.W. (eds) Fisheries Techniques,
2nd Edition. American Fisheries Society.
}
