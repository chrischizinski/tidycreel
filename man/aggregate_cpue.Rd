% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aggregate-cpue.R
\name{aggregate_cpue}
\alias{aggregate_cpue}
\title{Aggregate CPUE Across Species (REBUILT with Native Survey Integration)}
\usage{
aggregate_cpue(
  cpue_data,
  svy_design,
  species_col = "species",
  species_values,
  group_name,
  by = NULL,
  response = c("catch_total", "catch_kept", "catch_released"),
  effort_col = "hours_fished",
  mode = "ratio_of_means",
  conf_level = 0.95,
  variance_method = "survey",
  decompose_variance = FALSE,
  design_diagnostics = FALSE,
  n_replicates = 1000
)
}
\arguments{
\item{cpue_data}{Interview data (raw, before estimation) containing catch by species}

\item{svy_design}{Survey design object (\code{svydesign} or \code{svrepdesign}) built on \code{cpue_data}}

\item{species_col}{Column name containing species identifier}

\item{species_values}{Character vector of species to aggregate}

\item{group_name}{Name for the aggregated group (e.g., "black_bass", "panfish")}

\item{by}{Additional grouping variables (e.g., \code{c("location", "date")})}

\item{response}{Type of catch: \code{"catch_total"}, \code{"catch_kept"}, or \code{"catch_released"}}

\item{effort_col}{Effort column for denominator (default \code{"hours_fished"})}

\item{mode}{Estimation mode: \code{"auto"}, \code{"ratio_of_means"}, or \code{"mean_of_ratios"}.
Defaults to \code{"ratio_of_means"} for robustness.}

\item{conf_level}{Confidence level for Wald CIs (default 0.95)}

\item{variance_method}{\strong{NEW} Variance estimation method (default "survey")}

\item{decompose_variance}{\strong{NEW} Logical, decompose variance (default FALSE)}

\item{design_diagnostics}{\strong{NEW} Logical, compute diagnostics (default FALSE)}

\item{n_replicates}{\strong{NEW} Bootstrap/jackknife replicates (default 1000)}
}
\value{
Tibble with grouping columns (including \code{species_group}), \code{estimate},
\code{se}, \code{ci_low}, \code{ci_high}, \code{deff} (design effect), \code{n}, \code{method},
\code{diagnostics} list-column, and \code{variance_info} list-column.
}
\description{
Combines CPUE estimates for multiple species into a single aggregate,
properly accounting for survey design and covariance between species with
NATIVE support for advanced variance methods.
}
\details{
\strong{NEW}: Native support for multiple variance methods, variance decomposition,
and design diagnostics without requiring wrapper functions.

\strong{Statistical Approach:}

This function performs survey-design-based aggregation, which is CRITICAL for
proper variance estimation. It works by:
\enumerate{
\item Creating an aggregated catch variable by summing catch across specified species
\item Updating the survey design with this aggregated variable
\item Estimating CPUE for the aggregate using standard survey methods
\item Properly accounting for covariance between species
}

\strong{Why This Matters:}

Simply adding species-specific harvest estimates ignores covariance between species.
This function ensures proper variance by aggregating at the CPUE level.
}
\examples{
\dontrun{
# BACKWARD COMPATIBLE
cpue_black_bass <- aggregate_cpue(
  interviews, svy_int,
  species_values = c("largemouth_bass", "smallmouth_bass"),
  group_name = "black_bass"
)

# NEW: Advanced features
cpue_black_bass <- aggregate_cpue(
  interviews, svy_int,
  species_values = c("largemouth_bass", "smallmouth_bass"),
  group_name = "black_bass",
  variance_method = "bootstrap",
  decompose_variance = TRUE,
  design_diagnostics = TRUE
)
}

}
\seealso{
\code{\link[=est_cpue]{est_cpue()}}, \code{\link[=est_total_harvest]{est_total_harvest()}}
}
