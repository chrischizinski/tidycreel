% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/variance-decomposition.R
\name{decompose_variance}
\alias{decompose_variance}
\title{Decompose Variance Components in Creel Survey Estimates}
\usage{
decompose_variance(
  design,
  response,
  by = NULL,
  method = "survey",
  n_bootstrap = 1000,
  conf_level = 0.95,
  cluster_vars = c("stratum"),
  finite_pop = TRUE
)
}
\arguments{
\item{design}{Survey design object from \code{\link{as_day_svydesign}} or
\code{\link[survey]{svydesign}}}

\item{response}{Formula or character string specifying the response variable
for decomposition (e.g., "anglers_count" or ~anglers_count)}

\item{by}{Character vector of grouping variables for stratified decomposition}

\item{method}{Method for variance decomposition. Options:
\describe{
\item{"survey"}{Survey-weighted decomposition using survey package (default)}
\item{"bootstrap"}{Bootstrap-based variance decomposition}
\item{"jackknife"}{Jackknife variance decomposition}
\item{"linearization"}{Taylor linearization (for complex estimates)}
}}

\item{n_bootstrap}{Number of bootstrap replicates (if method = "bootstrap")}

\item{conf_level}{Confidence level for variance component intervals (default 0.95)}

\item{cluster_vars}{Character vector specifying clustering variables in order
of nesting (e.g., c("stratum", "day", "shift"))}

\item{finite_pop}{Logical, whether to apply finite population correction}
}
\value{
List with class "variance_decomp" containing:
\describe{
\item{components}{Data frame of variance components with estimates and confidence intervals}
\item{proportions}{Proportion of total variance explained by each component}
\item{intraclass_correlations}{Intraclass correlation coefficients}
\item{design_effects}{Design effects for different sampling strategies}
\item{optimal_allocation}{Recommended allocation across levels}
\item{variance_ratios}{Ratios used for sample size determination}
\item{nested_structure}{Description of the hierarchical structure}
\item{method_info}{Information about the decomposition method used}
\item{sample_sizes}{Sample sizes at each level}
}
}
\description{
Decomposes the total variance of creel survey estimates into component
sources (within-day, among-day, within-shift, etc.) using survey design
objects to guide optimal sampling design and allocation decisions.
}
\details{
\subsection{Variance Component Model}{

For a typical creel survey with nested structure:

\if{html}{\out{<div class="sourceCode">}}\preformatted{Y_ijkl = μ + α_i + β_j(i) + γ_k(ij) + ε_l(ijk)
}\if{html}{\out{</div>}}

Where:
\itemize{
\item Y_ijkl = observed value (e.g., angler count)
\item μ = overall mean
\item α_i = stratum effect (among-stratum variance)
\item β_j(i) = day effect within stratum (among-day variance)
\item γ_k(ij) = shift effect within day (among-shift variance)
\item ε_l(ijk) = residual error (within-shift variance)
}
}

\subsection{Key Variance Components}{
\enumerate{
\item \strong{Among-Day Variance (σ²_b)}: Variation between different days
\item \strong{Within-Day Variance (σ²_w)}: Variation within days (between shifts/counts)
\item \strong{Among-Shift Variance}: Variation between shifts within days
\item \strong{Residual Variance}: Unexplained variation
}
}

\subsection{Applications}{
\itemize{
\item \strong{Optimal Allocation}: Determine optimal number of days vs counts per day
\item \strong{Design Effects}: Quantify impact of clustering on precision
\item \strong{Sample Size Planning}: Use variance ratios for power calculations
\item \strong{Survey Efficiency}: Identify largest sources of variation
}
}

\subsection{Intraclass Correlation}{

ICC = σ²_between / (σ²_between + σ²_within)

High ICC indicates strong clustering (similar values within clusters)
}
}
\examples{
\dontrun{
# Basic variance decomposition
effort_est <- est_effort(design, by = "stratum")
var_decomp <- decompose_variance(
  effort_est = effort_est,
  data = counts_data,
  level = c("day", "stratum"),
  components = c("within_day", "among_day")
)

# Comprehensive decomposition with shifts
var_decomp <- decompose_variance(
  effort_est = effort_est,
  data = counts_data,
  level = c("shift", "day", "stratum"),
  components = c("within_shift", "among_shift", "among_day"),
  shift_col = "shift_block"
)

# Print results
print(var_decomp)

# Plot variance components
plot(var_decomp)
}

}
\references{
Rasmussen, P.W., Heisey, D.M., Nordheim, E.V., and Frost, T.M. (1998).
Time-series intervention analysis: unreplicated large-scale experiments.
In \emph{Scheiner, S.M. and Gurevitch, J. (eds.) Design and Analysis of
Ecological Experiments}. Oxford University Press.
}
\seealso{
\code{\link{est_effort}}, \code{\link{optimal_allocation}},
\code{\link{plot.variance_decomp}}
}
