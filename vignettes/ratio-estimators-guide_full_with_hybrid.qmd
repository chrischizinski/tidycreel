---
title: "Ratio Estimators: When to Use Ratio-of-Means vs Mean-of-Ratios"
format:
  html:
    toc: true
    toc-title: "Table of contents"
    code-fold: false
---

<!-- Original HTML content with injected Hybrid section -->
<body class="quarto-light">
<div class="page-columns page-rows-contents page-layout-article" id="quarto-content">
<div class="sidebar margin-sidebar" id="quarto-margin-sidebar">
<nav class="toc-active" id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a class="nav-link active" data-scroll-target="#introduction" href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a class="nav-link" data-scroll-target="#quick-answer-decision-tree" href="#quick-answer-decision-tree" id="toc-quick-answer-decision-tree">Quick Answer: Decision Tree</a></li>
<li><a class="nav-link" data-scroll-target="#theoretical-background" href="#theoretical-background" id="toc-theoretical-background">Theoretical Background</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#access-point-complete-trip-interviews" href="#access-point-complete-trip-interviews" id="toc-access-point-complete-trip-interviews">Access Point (Complete Trip) Interviews</a></li>
<li><a class="nav-link" data-scroll-target="#roving-incomplete-trip-interviews" href="#roving-incomplete-trip-interviews" id="toc-roving-incomplete-trip-interviews">Roving (Incomplete Trip) Interviews</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#simulation-study" href="#simulation-study" id="toc-simulation-study">Simulation Study</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#simulation-setup" href="#simulation-setup" id="toc-simulation-setup">Simulation Setup</a></li>
<li><a class="nav-link" data-scroll-target="#scenario-1-access-point-interviews-complete-trips" href="#scenario-1-access-point-interviews-complete-trips" id="toc-scenario-1-access-point-interviews-complete-trips">Scenario 1: Access Point Interviews (Complete Trips)</a></li>
<li><a class="nav-link" data-scroll-target="#scenario-2-roving-interviews-incomplete-trips" href="#scenario-2-roving-interviews-incomplete-trips" id="toc-scenario-2-roving-interviews-incomplete-trips">Scenario 2: Roving Interviews (Incomplete Trips)</a></li>
<li><a class="nav-link" data-scroll-target="#monte-carlo-simulation" href="#monte-carlo-simulation" id="toc-monte-carlo-simulation">Monte Carlo Simulation</a></li>
<li><a class="nav-link" data-scroll-target="#results-access-point-design" href="#results-access-point-design" id="toc-results-access-point-design">Results: Access Point Design</a></li>
<li><a class="nav-link" data-scroll-target="#results-roving-design" href="#results-roving-design" id="toc-results-roving-design">Results: Roving Design</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#practical-implementation-with-tidycreel" href="#practical-implementation-with-tidycreel" id="toc-practical-implementation-with-tidycreel">Practical Implementation with tidycreel</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#access-point-survey-example" href="#access-point-survey-example" id="toc-access-point-survey-example">Access Point Survey Example</a></li>
<li><a class="nav-link" data-scroll-target="#roving-survey-example" href="#roving-survey-example" id="toc-roving-survey-example">Roving Survey Example</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#variance-estimation" href="#variance-estimation" id="toc-variance-estimation">Variance Estimation</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#access-point-ratio-of-means" href="#access-point-ratio-of-means" id="toc-access-point-ratio-of-means">Access Point (Ratio-of-Means)</a></li>
<li><a class="nav-link" data-scroll-target="#roving-mean-of-ratios-with-truncation" href="#roving-mean-of-ratios-with-truncation" id="toc-roving-mean-of-ratios-with-truncation">Roving (Mean-of-Ratios with Truncation)</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#special-considerations" href="#special-considerations" id="toc-special-considerations">Special Considerations</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#bag-limits" href="#bag-limits" id="toc-bag-limits">Bag Limits</a></li>
<li><a class="nav-link" data-scroll-target="#nonstationary-catch-rates" href="#nonstationary-catch-rates" id="toc-nonstationary-catch-rates">Nonstationary Catch Rates</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#summary-practical-guidelines" href="#summary-practical-guidelines" id="toc-summary-practical-guidelines">Summary: Practical Guidelines</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#decision-rules" href="#decision-rules" id="toc-decision-rules">Decision Rules</a></li>
<li><a class="nav-link" data-scroll-target="#pre-processing-checklist" href="#pre-processing-checklist" id="toc-pre-processing-checklist">Pre-processing Checklist</a></li>
<li><a class="nav-link" data-scroll-target="#variance-estimation-checklist" href="#variance-estimation-checklist" id="toc-variance-estimation-checklist">Variance Estimation Checklist</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#references" href="#references" id="toc-references">References</a></li>
<li><a class="nav-link" data-scroll-target="#conclusion" href="#conclusion" id="toc-conclusion">Conclusion</a></li>
</ul>
</nav>
</div>
<main class="content" id="quarto-document-content">
<header class="quarto-title-block default" id="title-block-header">
<div class="quarto-title">
<h1 class="title">Ratio Estimators: When to Use Ratio-of-Means vs Mean-of-Ratios</h1>
</div>
<div class="quarto-title-meta">
</div>
</header>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8" tabindex="-1"></a><span class="co"># Try to load tidycreel if available (for the practical examples)</span></span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9" tabindex="-1"></a><span class="co"># The simulations work without it</span></span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"tidycreel"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11" tabindex="-1"></a>  <span class="fu">library</span>(tidycreel)</span>
<span id="cb1-12"><a aria-hidden="true" href="#cb1-12" tabindex="-1"></a>  has_tidycreel <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb1-13"><a aria-hidden="true" href="#cb1-13" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-14"><a aria-hidden="true" href="#cb1-14" tabindex="-1"></a>  has_tidycreel <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-15"><a aria-hidden="true" href="#cb1-15" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Note: tidycreel not installed. Practical examples will not run, but simulations will work."</span>)</span>
<span id="cb1-16"><a aria-hidden="true" href="#cb1-16" tabindex="-1"></a>}</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
</div>
<section class="level2" id="introduction">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>One of the most common questions in creel survey analysis is: <strong>“Should I use ratio-of-means or mean-of-ratios to estimate catch rate?”</strong></p>
<p>This vignette answers that question through:</p>
<ol type="1">
<li><strong>Decision rules</strong> based on survey design type</li>
<li><strong>Simulation demonstrations</strong> showing estimator performance</li>
<li><strong>Practical guidance</strong> on variance estimation</li>
<li><strong>Clear examples</strong> using <code>tidycreel</code></li>
</ol>
</section>
<section class="level2" id="quick-answer-decision-tree">
<h2 class="anchored" data-anchor-id="quick-answer-decision-tree">Quick Answer: Decision Tree</h2>
<pre><code>┌─────────────────────────────────────────────┐
│   What type of interviews do you have?      │
└─────────────────┬───────────────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
    ┌───▼──────┐          ┌───▼────────┐
    │ ACCESS   │          │ ROVING     │
    │(Complete │          │(Incomplete │
    │ trips)   │          │  trips)    │
    └───┬──────┘          └───┬────────┘
        │                     │
        │                     │
    ┌───▼─────────────────┐   │
    │ Use RATIO-OF-MEANS  │   │
    │  R₁ = Σcatch/Σeffort│   │
    │                     │   │
    │ Why? Each angler    │   │
    │ has equal sampling  │   │
    │ probability.        │   │
    │                     │   │
    │ ✓ Unbiased          │   │
    │ ✓ Finite variance   │   │
    └─────────────────────┘   │
                              │
                  ┌───────────▼────────────────┐
                  │ Use MEAN-OF-RATIOS         │
                  │  R₂ = (1/n)Σ(catch/effort) │
                  │                            │
                  │ IMPORTANT: Truncate short  │
                  │ trips (&lt; 20-30 minutes)    │
                  │                            │
                  │ Why? Sampling probability  │
                  │ ∝ trip length. R₁ would    │
                  │ give biased estimate.      │
                  │                            │
                  │ ⚠ Avoid if bag limits      │
                  │   are low &amp; easily obtained│
                  └────────────────────────────┘</code></pre>
</section>
<section class="level2" id="theoretical-background">
<h2 class="anchored" data-anchor-id="theoretical-background">Theoretical Background</h2>
<section class="level3" id="access-point-complete-trip-interviews">
<h3 class="anchored" data-anchor-id="access-point-complete-trip-interviews">Access Point (Complete Trip) Interviews</h3>
<p><strong>Sampling Design:</strong></p>
<ul>
<li>Interviews conducted as anglers <strong>complete</strong> their trips</li>
<li>All anglers have <strong>equal probability</strong> of being interviewed</li>
<li>P(interviewed) = constant, regardless of trip length</li>
</ul>
<p><strong>Appropriate Estimator: Ratio-of-Means (R₁)</strong></p>
<p><span class="math display">\[\hat{R}_1 = \frac{\sum_{j=1}^{n} C_j^*}{\sum_{j=1}^{n} L_j^*}\]</span></p>
<p>where <span class="math inline">\(C_j^*\)</span> = total catch for the <strong>completed trip</strong> and <span class="math inline">\(L_j^*\)</span> = total trip length <strong>at completion</strong>.</p>
<p><strong>Expected Value:</strong> <span class="math display">\[E(\hat{R}_1) \approx \frac{\text{Total Catch}}{\text{Total Effort}}\]</span></p>
<p>✓ <strong>This is what we want for total catch estimation!</strong></p>
</section>
<section class="level3" id="roving-incomplete-trip-interviews">
<h3 class="anchored" data-anchor-id="roving-incomplete-trip-interviews">Roving (Incomplete Trip) Interviews</h3>
<p><strong>Sampling Design:</strong></p>
<ul>
<li>Interviews conducted <strong>during</strong> fishing trips</li>
<li>Sampling probability <strong>∝ trip length</strong></li>
<li>Longer trips are more likely to be encountered</li>
</ul>
<p><strong>Appropriate Estimator: Mean-of-Ratios (R₂) with Truncation</strong></p>
<p><span class="math display">\[\hat{R}_2 = \frac{1}{n} \sum_{j=1}^{n} \frac{C_j}{L_j}\]</span></p>
<p>where <span class="math inline">\(C_j\)</span> = catch <strong>at time of interview</strong> and <span class="math inline">\(L_j\)</span> = elapsed time <strong>at interview</strong>.</p>
<p><strong>With truncation:</strong> Only include interviews where <span class="math inline">\(L_j &gt; L_{min}\)</span> (typically 20-30 minutes).</p>
<p><strong>Expected Value:</strong> <span class="math display">\[E(\hat{R}_2) \approx \frac{\text{Total Catch}}{\text{Total Effort}}\]</span></p>
<p>✓ <strong>Correct for roving interviews!</strong></p>
<p><strong>Why NOT use R₁ for roving?</strong></p>
<p>The ratio-of-means for roving interviews has: <span class="math display">\[E(\hat{R}_1^{roving}) \approx \frac{\sum L_j^{*2} \cdot (C_j^*/L_j^*)}{\sum L_j^{*2}}\]</span></p>
<p>This is a <strong>weighted average</strong> with weights = (trip length)², which does <strong>not</strong> estimate the population catch rate!</p>
</section>
<section class="level2" id="handling-mixed-complete-and-incomplete-trips">
<h2 class="anchored">Handling Mixed Complete and Incomplete Trips</h2>
<p><strong>Why this matters:</strong> Real creel surveys often produce a mix of <em>completed</em> (access-point) and <em>incomplete</em> (roving/intercept) interviews. Estimator choice must follow the <strong>inclusion probability</strong>, not just trip status, to avoid bias.</p>
<h3 class="anchored">Principle</h3>
<p>When inclusion probability differs by design (equal-probability at access points vs. length-biased in roving), pooling interviews and applying a single estimator can introduce bias. Treat designs according to their sampling properties.</p>
<h3 class="anchored">1️⃣ Separate Estimation (Recommended)</h3>
<p>Treat complete and incomplete interviews as two strata, then combine by <strong>effort weighting</strong>:</p>
<ul>
<li><strong>Complete trips (access point):</strong> use <em>Ratio-of-Means</em> (R₁ = ΣC / ΣE).</li>
<li><strong>Incomplete trips (roving):</strong> use <em>Mean-of-Ratios</em> (R₂ = (1/n) Σ(C/E)) with <strong>truncation</strong> of short trips (e.g., &lt; 20–30 min).</li>
</ul>
<p><strong>Effort-weighted combination:</strong></p>
<p>$$
\hat{R}_{\text{combined}} = \frac{R_1 E_{\text{complete}} + R_2 E_{\text{incomplete}}}{E_{\text{complete}} + E_{\text{incomplete}}}
$$</p>
<h3 class="anchored">2️⃣ Model-Based Weighting (optional)</h3>
<p>If you can estimate selection/inclusion probabilities (e.g., a model for trip completeness or roving intercept likelihood), use a weighted ratio:</p>
<p>$$
\hat{R}_{\text{weighted}} = \frac{\sum_i w_i C_i}{\sum_i w_i E_i}, \quad w_i = 1 / P(\text{select}_i).
$$</p>
<p>This is useful for hybrid designs where sampling varies predictably across modes, times, or sites.</p>
<h3 class="anchored">3️⃣ Sensitivity Analysis</h3>
<p>Compute: (a) R₁ on complete only, (b) R₂ on incomplete (with truncation), and (c) the combined estimator. If differences are small (e.g., &lt; 5–10%), pooling assumptions may be reasonable; document them.</p>
<h3 class="anchored">Cautions</h3>
<ul>
<li>Do <strong>not</strong> apply R₁ to unfiltered roving data — it is biased high due to length-biased sampling.</li>
<li>Do <strong>not</strong> apply R₂ to complete trips only — bias direction depends on effort variability.</li>
<li>Always truncate short incomplete trips to stabilize R₂ and reduce small-denominator issues.</li>
<li>When bag limits are frequently hit, be cautious with R₂ (ceiling effects can distort ratios).</li>
</ul>
<h3 class="anchored">Implementation sketch (R)</h3>
<pre><code class="language-r">complete &lt;- data %&gt;% dplyr::filter(trip_complete == TRUE)
incomplete &lt;- data %&gt;% dplyr::filter(trip_complete == FALSE, trip_length &gt;= 0.5)  # 0.5 h = 30 min

r1 &lt;- sum(complete$catch) / sum(complete$effort)
r2 &lt;- mean(incomplete$catch / incomplete$effort)

E1 &lt;- sum(complete$effort)
E2 &lt;- sum(incomplete$effort)

R_combined &lt;- (r1 * E1 + r2 * E2) / (E1 + E2)
</code></pre>
<h3 class="anchored">Variance note</h3>
<p>Estimate SEs for each stratum with the appropriate formula (delta-method for R₁; sample variance of ratios for R₂), then combine via delta-method using the effort-weight combination above.</p>
</section>

</section>
<section class="level2" id="simulation-study">
<h2 class="anchored" data-anchor-id="simulation-study">Simulation Study</h2>
<p>The theoretical results above show <strong>why</strong> estimator choice matters. But how large is the bias in practice? And does truncation really help?</p>
<p>Let’s demonstrate these principles through simulation, following the approach of Rasmussen et al. (1998) and Pollock et al. (1997).</p>
<section class="level3" id="simulation-setup">
<h3 class="anchored" data-anchor-id="simulation-setup">Simulation Setup</h3>
<p>We’ll simulate a realistic fishing scenario and compare estimator performance.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a><span class="co">#' Simulate a day of fishing with known parameters</span></span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a><span class="co">#' @param n_anglers Number of anglers fishing during the day</span></span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a><span class="co">#' @param mean_trip_hours Mean trip length (hours)</span></span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5" tabindex="-1"></a><span class="co">#' @param mean_catch_rate Mean catch per hour (Poisson rate parameter)</span></span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6" tabindex="-1"></a><span class="co">#' @param day_length_hours Length of fishing day</span></span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7" tabindex="-1"></a><span class="co">#' @return List with population parameters and individual angler data</span></span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8" tabindex="-1"></a>simulate_fishing_day <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_anglers =</span> <span class="dv">100</span>,</span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9" tabindex="-1"></a>                                 <span class="at">mean_trip_hours =</span> <span class="dv">4</span>,</span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10" tabindex="-1"></a>                                 <span class="at">mean_catch_rate =</span> <span class="dv">2</span>,</span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11" tabindex="-1"></a>                                 <span class="at">day_length_hours =</span> <span class="dv">12</span>) {</span>
<span id="cb3-12"><a aria-hidden="true" href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a aria-hidden="true" href="#cb3-13" tabindex="-1"></a>  <span class="co"># Each angler's true catch rate (gamma-distributed for heterogeneity)</span></span>
<span id="cb3-14"><a aria-hidden="true" href="#cb3-14" tabindex="-1"></a>  <span class="co"># Shape = 1, rate = 1/mean gives exponential with specified mean</span></span>
<span id="cb3-15"><a aria-hidden="true" href="#cb3-15" tabindex="-1"></a>  <span class="co"># This creates variation in angler skill/success</span></span>
<span id="cb3-16"><a aria-hidden="true" href="#cb3-16" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-17"><a aria-hidden="true" href="#cb3-17" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> mean_catch_rate</span>
<span id="cb3-18"><a aria-hidden="true" href="#cb3-18" tabindex="-1"></a>  catch_rates <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n_anglers, <span class="at">shape =</span> alpha, <span class="at">rate =</span> beta)</span>
<span id="cb3-19"><a aria-hidden="true" href="#cb3-19" tabindex="-1"></a></span>
<span id="cb3-20"><a aria-hidden="true" href="#cb3-20" tabindex="-1"></a>  <span class="co"># Trip lengths (gamma-distributed)</span></span>
<span id="cb3-21"><a aria-hidden="true" href="#cb3-21" tabindex="-1"></a>  shape_trip <span class="ot">&lt;-</span> <span class="dv">4</span>  <span class="co"># Controls variability</span></span>
<span id="cb3-22"><a aria-hidden="true" href="#cb3-22" tabindex="-1"></a>  rate_trip <span class="ot">&lt;-</span> shape_trip <span class="sc">/</span> mean_trip_hours</span>
<span id="cb3-23"><a aria-hidden="true" href="#cb3-23" tabindex="-1"></a>  trip_lengths <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n_anglers, <span class="at">shape =</span> shape_trip, <span class="at">rate =</span> rate_trip)</span>
<span id="cb3-24"><a aria-hidden="true" href="#cb3-24" tabindex="-1"></a>  trip_lengths <span class="ot">&lt;-</span> <span class="fu">pmin</span>(trip_lengths, day_length_hours)  <span class="co"># Can't exceed day length</span></span>
<span id="cb3-25"><a aria-hidden="true" href="#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a aria-hidden="true" href="#cb3-26" tabindex="-1"></a>  <span class="co"># Generate catches for each angler (Poisson process)</span></span>
<span id="cb3-27"><a aria-hidden="true" href="#cb3-27" tabindex="-1"></a>  <span class="co"># Expected catch = catch_rate * trip_length</span></span>
<span id="cb3-28"><a aria-hidden="true" href="#cb3-28" tabindex="-1"></a>  completed_catch <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n_anglers, <span class="at">lambda =</span> catch_rates <span class="sc">*</span> trip_lengths)</span>
<span id="cb3-29"><a aria-hidden="true" href="#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a aria-hidden="true" href="#cb3-30" tabindex="-1"></a>  <span class="co"># True population parameters</span></span>
<span id="cb3-31"><a aria-hidden="true" href="#cb3-31" tabindex="-1"></a>  total_effort <span class="ot">&lt;-</span> <span class="fu">sum</span>(trip_lengths)</span>
<span id="cb3-32"><a aria-hidden="true" href="#cb3-32" tabindex="-1"></a>  total_catch <span class="ot">&lt;-</span> <span class="fu">sum</span>(completed_catch)</span>
<span id="cb3-33"><a aria-hidden="true" href="#cb3-33" tabindex="-1"></a>  true_catch_rate <span class="ot">&lt;-</span> total_catch <span class="sc">/</span> total_effort</span>
<span id="cb3-34"><a aria-hidden="true" href="#cb3-34" tabindex="-1"></a></span>
<span id="cb3-35"><a aria-hidden="true" href="#cb3-35" tabindex="-1"></a>  <span class="co"># Return angler-level data</span></span>
<span id="cb3-36"><a aria-hidden="true" href="#cb3-36" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb3-37"><a aria-hidden="true" href="#cb3-37" tabindex="-1"></a>    <span class="at">angler_id =</span> <span class="dv">1</span><span class="sc">:</span>n_anglers,</span>
<span id="cb3-38"><a aria-hidden="true" href="#cb3-38" tabindex="-1"></a>    <span class="at">catch_rate_true =</span> catch_rates,</span>
<span id="cb3-39"><a aria-hidden="true" href="#cb3-39" tabindex="-1"></a>    <span class="at">trip_length =</span> trip_lengths,</span>
<span id="cb3-40"><a aria-hidden="true" href="#cb3-40" tabindex="-1"></a>    <span class="at">completed_catch =</span> completed_catch,</span>
<span id="cb3-41"><a aria-hidden="true" href="#cb3-41" tabindex="-1"></a>    <span class="at">true_population_rate =</span> true_catch_rate,</span>
<span id="cb3-42"><a aria-hidden="true" href="#cb3-42" tabindex="-1"></a>    <span class="at">total_effort =</span> total_effort,</span>
<span id="cb3-43"><a aria-hidden="true" href="#cb3-43" tabindex="-1"></a>    <span class="at">total_catch =</span> total_catch</span>
<span id="cb3-44"><a aria-hidden="true" href="#cb3-44" tabindex="-1"></a>  )</span>
<span id="cb3-45"><a aria-hidden="true" href="#cb3-45" tabindex="-1"></a>}</span>
<span id="cb3-46"><a aria-hidden="true" href="#cb3-46" tabindex="-1"></a></span>
<span id="cb3-47"><a aria-hidden="true" href="#cb3-47" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb3-48"><a aria-hidden="true" href="#cb3-48" tabindex="-1"></a>fishing_day <span class="ot">&lt;-</span> <span class="fu">simulate_fishing_day</span>(<span class="at">n_anglers =</span> <span class="dv">100</span>)</span>
<span id="cb3-49"><a aria-hidden="true" href="#cb3-49" tabindex="-1"></a><span class="fu">head</span>(fishing_day)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  angler_id catch_rate_true trip_length completed_catch true_population_rate
      &lt;int&gt;           &lt;dbl&gt;       &lt;dbl&gt;           &lt;int&gt;                &lt;dbl&gt;
1         1           2.00         4.78               7                 2.15
2         2           2.26         1.56               5                 2.15
3         3           0.851        4.74               4                 2.15
4         4           1.03         6.06               5                 2.15
5         5           6.96         4.52              35                 2.15
6         6           0.627        5.59               3                 2.15
# ℹ 2 more variables: total_effort &lt;dbl&gt;, total_catch &lt;int&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a><span class="co"># Summary of true population parameters</span></span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"True Population Parameters:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Population Parameters:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Total anglers:"</span>, <span class="fu">nrow</span>(fishing_day), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Total anglers: 100 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Total effort:"</span>, <span class="fu">round</span>(fishing_day<span class="sc">$</span>total_effort[<span class="dv">1</span>], <span class="dv">1</span>), <span class="st">"hours</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Total effort: 391.8 hours</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a aria-hidden="true" href="#cb11-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Total catch:"</span>, fishing_day<span class="sc">$</span>total_catch[<span class="dv">1</span>], <span class="st">"fish</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Total catch: 844 fish</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a aria-hidden="true" href="#cb13-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  True catch rate:"</span>, <span class="fu">round</span>(fishing_day<span class="sc">$</span>true_population_rate[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">"fish/hour</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  True catch rate: 2.154 fish/hour</code></pre>
</div>
</div>
</section>
<section class="level3" id="scenario-1-access-point-interviews-complete-trips">
<h3 class="anchored" data-anchor-id="scenario-1-access-point-interviews-complete-trips">Scenario 1: Access Point Interviews (Complete Trips)</h3>
<p>Simulate a traditional access point creel where we interview anglers as they finish.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a aria-hidden="true" href="#cb15-1" tabindex="-1"></a><span class="co">#' Simulate access point interviews</span></span>
<span id="cb15-2"><a aria-hidden="true" href="#cb15-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb15-3"><a aria-hidden="true" href="#cb15-3" tabindex="-1"></a><span class="co">#' @param fishing_day Tibble from simulate_fishing_day()</span></span>
<span id="cb15-4"><a aria-hidden="true" href="#cb15-4" tabindex="-1"></a><span class="co">#' @param n_interviews Number of interviews to conduct</span></span>
<span id="cb15-5"><a aria-hidden="true" href="#cb15-5" tabindex="-1"></a><span class="co">#' @return Tibble with interview data</span></span>
<span id="cb15-6"><a aria-hidden="true" href="#cb15-6" tabindex="-1"></a>sample_access_interviews <span class="ot">&lt;-</span> <span class="cf">function</span>(fishing_day, <span class="at">n_interviews =</span> <span class="dv">30</span>) {</span>
<span id="cb15-7"><a aria-hidden="true" href="#cb15-7" tabindex="-1"></a>  <span class="co"># Simple random sample (equal probability)</span></span>
<span id="cb15-8"><a aria-hidden="true" href="#cb15-8" tabindex="-1"></a>  sampled <span class="ot">&lt;-</span> fishing_day <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a aria-hidden="true" href="#cb15-9" tabindex="-1"></a>    <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fu">min</span>(n_interviews, <span class="fu">nrow</span>(fishing_day)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a aria-hidden="true" href="#cb15-10" tabindex="-1"></a>    <span class="fu">select</span>(angler_id, completed_catch, trip_length, true_population_rate)</span>
<span id="cb15-11"><a aria-hidden="true" href="#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a aria-hidden="true" href="#cb15-12" tabindex="-1"></a>  sampled</span>
<span id="cb15-13"><a aria-hidden="true" href="#cb15-13" tabindex="-1"></a>}</span>
<span id="cb15-14"><a aria-hidden="true" href="#cb15-14" tabindex="-1"></a></span>
<span id="cb15-15"><a aria-hidden="true" href="#cb15-15" tabindex="-1"></a><span class="co"># Single realization</span></span>
<span id="cb15-16"><a aria-hidden="true" href="#cb15-16" tabindex="-1"></a>access_sample <span class="ot">&lt;-</span> <span class="fu">sample_access_interviews</span>(fishing_day, <span class="at">n_interviews =</span> <span class="dv">30</span>)</span>
<span id="cb15-17"><a aria-hidden="true" href="#cb15-17" tabindex="-1"></a><span class="fu">head</span>(access_sample)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  angler_id completed_catch trip_length true_population_rate
      &lt;int&gt;           &lt;int&gt;       &lt;dbl&gt;                &lt;dbl&gt;
1         1               7        4.78                 2.15
2        69               4        5.05                 2.15
3        79              14        6.27                 2.15
4        19               5        6.75                 2.15
5        12               1        4.72                 2.15
6        64               0        5.88                 2.15</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a aria-hidden="true" href="#cb17-1" tabindex="-1"></a><span class="co"># Calculate both estimators</span></span>
<span id="cb17-2"><a aria-hidden="true" href="#cb17-2" tabindex="-1"></a>calculate_estimates <span class="ot">&lt;-</span> <span class="cf">function</span>(interviews, <span class="at">truncate_minutes =</span> <span class="cn">NULL</span>) {</span>
<span id="cb17-3"><a aria-hidden="true" href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a aria-hidden="true" href="#cb17-4" tabindex="-1"></a>  <span class="co"># Apply truncation if specified (for roving surveys)</span></span>
<span id="cb17-5"><a aria-hidden="true" href="#cb17-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(truncate_minutes)) {</span>
<span id="cb17-6"><a aria-hidden="true" href="#cb17-6" tabindex="-1"></a>    interviews <span class="ot">&lt;-</span> interviews <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a aria-hidden="true" href="#cb17-7" tabindex="-1"></a>      <span class="fu">filter</span>(trip_length <span class="sc">&gt;=</span> truncate_minutes <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb17-8"><a aria-hidden="true" href="#cb17-8" tabindex="-1"></a>  }</span>
<span id="cb17-9"><a aria-hidden="true" href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a aria-hidden="true" href="#cb17-10" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(interviews)</span>
<span id="cb17-11"><a aria-hidden="true" href="#cb17-11" tabindex="-1"></a></span>
<span id="cb17-12"><a aria-hidden="true" href="#cb17-12" tabindex="-1"></a>  <span class="co"># Ratio-of-means</span></span>
<span id="cb17-13"><a aria-hidden="true" href="#cb17-13" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(interviews<span class="sc">$</span>completed_catch) <span class="sc">/</span> <span class="fu">sum</span>(interviews<span class="sc">$</span>trip_length)</span>
<span id="cb17-14"><a aria-hidden="true" href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a aria-hidden="true" href="#cb17-15" tabindex="-1"></a>  <span class="co"># Mean-of-ratios</span></span>
<span id="cb17-16"><a aria-hidden="true" href="#cb17-16" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(interviews<span class="sc">$</span>completed_catch <span class="sc">/</span> interviews<span class="sc">$</span>trip_length)</span>
<span id="cb17-17"><a aria-hidden="true" href="#cb17-17" tabindex="-1"></a></span>
<span id="cb17-18"><a aria-hidden="true" href="#cb17-18" tabindex="-1"></a>  <span class="co"># Variance estimates (simplified)</span></span>
<span id="cb17-19"><a aria-hidden="true" href="#cb17-19" tabindex="-1"></a>  <span class="co"># For R1: use delta method (Taylor series approximation)</span></span>
<span id="cb17-20"><a aria-hidden="true" href="#cb17-20" tabindex="-1"></a>  <span class="co"># Var(R₁) ≈ (1/n·E̅²) · Var(C - R₁·E)</span></span>
<span id="cb17-21"><a aria-hidden="true" href="#cb17-21" tabindex="-1"></a>  <span class="co"># where residual = catch - estimated_rate × effort</span></span>
<span id="cb17-22"><a aria-hidden="true" href="#cb17-22" tabindex="-1"></a>  r <span class="ot">&lt;-</span> interviews<span class="sc">$</span>completed_catch</span>
<span id="cb17-23"><a aria-hidden="true" href="#cb17-23" tabindex="-1"></a>  e <span class="ot">&lt;-</span> interviews<span class="sc">$</span>trip_length</span>
<span id="cb17-24"><a aria-hidden="true" href="#cb17-24" tabindex="-1"></a>  r_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(r)</span>
<span id="cb17-25"><a aria-hidden="true" href="#cb17-25" tabindex="-1"></a>  e_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(e)</span>
<span id="cb17-26"><a aria-hidden="true" href="#cb17-26" tabindex="-1"></a>  var_r1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">/</span> (n <span class="sc">*</span> e_bar<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">var</span>(r <span class="sc">-</span> r1 <span class="sc">*</span> e)</span>
<span id="cb17-27"><a aria-hidden="true" href="#cb17-27" tabindex="-1"></a>  se_r1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_r1)</span>
<span id="cb17-28"><a aria-hidden="true" href="#cb17-28" tabindex="-1"></a></span>
<span id="cb17-29"><a aria-hidden="true" href="#cb17-29" tabindex="-1"></a>  <span class="co"># For R2: simple variance of the ratios</span></span>
<span id="cb17-30"><a aria-hidden="true" href="#cb17-30" tabindex="-1"></a>  ratios <span class="ot">&lt;-</span> interviews<span class="sc">$</span>completed_catch <span class="sc">/</span> interviews<span class="sc">$</span>trip_length</span>
<span id="cb17-31"><a aria-hidden="true" href="#cb17-31" tabindex="-1"></a>  var_r2 <span class="ot">&lt;-</span> <span class="fu">var</span>(ratios) <span class="sc">/</span> n</span>
<span id="cb17-32"><a aria-hidden="true" href="#cb17-32" tabindex="-1"></a>  se_r2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_r2)</span>
<span id="cb17-33"><a aria-hidden="true" href="#cb17-33" tabindex="-1"></a></span>
<span id="cb17-34"><a aria-hidden="true" href="#cb17-34" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb17-35"><a aria-hidden="true" href="#cb17-35" tabindex="-1"></a>    <span class="at">n =</span> n,</span>
<span id="cb17-36"><a aria-hidden="true" href="#cb17-36" tabindex="-1"></a>    <span class="at">ratio_of_means =</span> r1,</span>
<span id="cb17-37"><a aria-hidden="true" href="#cb17-37" tabindex="-1"></a>    <span class="at">mean_of_ratios =</span> r2,</span>
<span id="cb17-38"><a aria-hidden="true" href="#cb17-38" tabindex="-1"></a>    <span class="at">se_r1 =</span> se_r1,</span>
<span id="cb17-39"><a aria-hidden="true" href="#cb17-39" tabindex="-1"></a>    <span class="at">se_r2 =</span> se_r2,</span>
<span id="cb17-40"><a aria-hidden="true" href="#cb17-40" tabindex="-1"></a>    <span class="at">true_rate =</span> interviews<span class="sc">$</span>true_population_rate[<span class="dv">1</span>]</span>
<span id="cb17-41"><a aria-hidden="true" href="#cb17-41" tabindex="-1"></a>  )</span>
<span id="cb17-42"><a aria-hidden="true" href="#cb17-42" tabindex="-1"></a>}</span>
<span id="cb17-43"><a aria-hidden="true" href="#cb17-43" tabindex="-1"></a></span>
<span id="cb17-44"><a aria-hidden="true" href="#cb17-44" tabindex="-1"></a>access_results <span class="ot">&lt;-</span> <span class="fu">calculate_estimates</span>(access_sample)</span>
<span id="cb17-45"><a aria-hidden="true" href="#cb17-45" tabindex="-1"></a>access_results</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
      n ratio_of_means mean_of_ratios se_r1 se_r2 true_rate
  &lt;int&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1    30           2.04           2.41 0.401 0.463      2.15</code></pre>
</div>
</div>
</section>
<section class="level3" id="scenario-2-roving-interviews-incomplete-trips">
<h3 class="anchored" data-anchor-id="scenario-2-roving-interviews-incomplete-trips">Scenario 2: Roving Interviews (Incomplete Trips)</h3>
<p>Now simulate roving interviews where anglers are intercepted during their trips.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a aria-hidden="true" href="#cb19-1" tabindex="-1"></a><span class="co">#' Simulate roving interviews</span></span>
<span id="cb19-2"><a aria-hidden="true" href="#cb19-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb19-3"><a aria-hidden="true" href="#cb19-3" tabindex="-1"></a><span class="co">#' @param fishing_day Tibble from simulate_fishing_day()</span></span>
<span id="cb19-4"><a aria-hidden="true" href="#cb19-4" tabindex="-1"></a><span class="co">#' @param n_interviews Target number of interviews</span></span>
<span id="cb19-5"><a aria-hidden="true" href="#cb19-5" tabindex="-1"></a><span class="co">#' @return Tibble with incomplete trip interview data</span></span>
<span id="cb19-6"><a aria-hidden="true" href="#cb19-6" tabindex="-1"></a>sample_roving_interviews <span class="ot">&lt;-</span> <span class="cf">function</span>(fishing_day, <span class="at">n_interviews =</span> <span class="dv">30</span>) {</span>
<span id="cb19-7"><a aria-hidden="true" href="#cb19-7" tabindex="-1"></a></span>
<span id="cb19-8"><a aria-hidden="true" href="#cb19-8" tabindex="-1"></a>  <span class="co"># Length-biased sampling: probability of encounter ∝ trip duration</span></span>
<span id="cb19-9"><a aria-hidden="true" href="#cb19-9" tabindex="-1"></a>  <span class="co"># P(interview angler i) = L_i / Σ L_j (normalized by total effort)</span></span>
<span id="cb19-10"><a aria-hidden="true" href="#cb19-10" tabindex="-1"></a>  <span class="co"># Longer trips have higher chance of being encountered during roving</span></span>
<span id="cb19-11"><a aria-hidden="true" href="#cb19-11" tabindex="-1"></a>  prob_intercept <span class="ot">&lt;-</span> fishing_day<span class="sc">$</span>trip_length <span class="sc">/</span> <span class="fu">sum</span>(fishing_day<span class="sc">$</span>trip_length)</span>
<span id="cb19-12"><a aria-hidden="true" href="#cb19-12" tabindex="-1"></a></span>
<span id="cb19-13"><a aria-hidden="true" href="#cb19-13" tabindex="-1"></a>  <span class="co"># Sample with probability proportional to size</span></span>
<span id="cb19-14"><a aria-hidden="true" href="#cb19-14" tabindex="-1"></a>  sampled_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb19-15"><a aria-hidden="true" href="#cb19-15" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(fishing_day),</span>
<span id="cb19-16"><a aria-hidden="true" href="#cb19-16" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">min</span>(n_interviews, <span class="fu">nrow</span>(fishing_day)),</span>
<span id="cb19-17"><a aria-hidden="true" href="#cb19-17" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-18"><a aria-hidden="true" href="#cb19-18" tabindex="-1"></a>    <span class="at">prob =</span> prob_intercept</span>
<span id="cb19-19"><a aria-hidden="true" href="#cb19-19" tabindex="-1"></a>  )</span>
<span id="cb19-20"><a aria-hidden="true" href="#cb19-20" tabindex="-1"></a></span>
<span id="cb19-21"><a aria-hidden="true" href="#cb19-21" tabindex="-1"></a>  sampled <span class="ot">&lt;-</span> fishing_day[sampled_indices, ]</span>
<span id="cb19-22"><a aria-hidden="true" href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a aria-hidden="true" href="#cb19-23" tabindex="-1"></a>  <span class="co"># For each intercepted angler, determine interview time</span></span>
<span id="cb19-24"><a aria-hidden="true" href="#cb19-24" tabindex="-1"></a>  <span class="co"># Uniform on [0, trip_length] (on average, intercepted at midpoint)</span></span>
<span id="cb19-25"><a aria-hidden="true" href="#cb19-25" tabindex="-1"></a>  sampled <span class="ot">&lt;-</span> sampled <span class="sc">%&gt;%</span></span>
<span id="cb19-26"><a aria-hidden="true" href="#cb19-26" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-27"><a aria-hidden="true" href="#cb19-27" tabindex="-1"></a>      <span class="co"># Time fished when interviewed (uniform on [0, trip_length])</span></span>
<span id="cb19-28"><a aria-hidden="true" href="#cb19-28" tabindex="-1"></a>      <span class="co"># On average, anglers are intercepted at midpoint of their trip</span></span>
<span id="cb19-29"><a aria-hidden="true" href="#cb19-29" tabindex="-1"></a>      <span class="at">time_at_interview =</span> <span class="fu">runif</span>(<span class="fu">n</span>(), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> trip_length),</span>
<span id="cb19-30"><a aria-hidden="true" href="#cb19-30" tabindex="-1"></a></span>
<span id="cb19-31"><a aria-hidden="true" href="#cb19-31" tabindex="-1"></a>      <span class="co"># Catch at interview time (incomplete trip)</span></span>
<span id="cb19-32"><a aria-hidden="true" href="#cb19-32" tabindex="-1"></a>      <span class="co"># Poisson process: E[catch | time_t] = λ × t</span></span>
<span id="cb19-33"><a aria-hidden="true" href="#cb19-33" tabindex="-1"></a>      <span class="co"># where λ = angler's true catch rate, t = time fished so far</span></span>
<span id="cb19-34"><a aria-hidden="true" href="#cb19-34" tabindex="-1"></a>      <span class="at">catch_at_interview =</span> <span class="fu">rpois</span>(<span class="fu">n</span>(), <span class="at">lambda =</span> catch_rate_true <span class="sc">*</span> time_at_interview)</span>
<span id="cb19-35"><a aria-hidden="true" href="#cb19-35" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb19-36"><a aria-hidden="true" href="#cb19-36" tabindex="-1"></a>    <span class="fu">select</span>(angler_id, catch_at_interview, time_at_interview,</span>
<span id="cb19-37"><a aria-hidden="true" href="#cb19-37" tabindex="-1"></a>           completed_catch, trip_length, true_population_rate)</span>
<span id="cb19-38"><a aria-hidden="true" href="#cb19-38" tabindex="-1"></a></span>
<span id="cb19-39"><a aria-hidden="true" href="#cb19-39" tabindex="-1"></a>  sampled</span>
<span id="cb19-40"><a aria-hidden="true" href="#cb19-40" tabindex="-1"></a>}</span>
<span id="cb19-41"><a aria-hidden="true" href="#cb19-41" tabindex="-1"></a></span>
<span id="cb19-42"><a aria-hidden="true" href="#cb19-42" tabindex="-1"></a>roving_sample <span class="ot">&lt;-</span> <span class="fu">sample_roving_interviews</span>(fishing_day, <span class="at">n_interviews =</span> <span class="dv">30</span>)</span>
<span id="cb19-43"><a aria-hidden="true" href="#cb19-43" tabindex="-1"></a><span class="fu">head</span>(roving_sample)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  angler_id catch_at_interview time_at_interview completed_catch trip_length
      &lt;int&gt;              &lt;int&gt;             &lt;dbl&gt;           &lt;int&gt;       &lt;dbl&gt;
1        27                  1             2.57                2        5.27
2        37                  4             1.46               13        2.99
3        81                  0             0.326               3        3.86
4        32                  1             2.30                8        5.76
5        97                  6             3.54               10        4.81
6        28                  4             2.58                5        2.72
# ℹ 1 more variable: true_population_rate &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a aria-hidden="true" href="#cb21-1" tabindex="-1"></a><span class="co"># For roving, use incomplete data</span></span>
<span id="cb21-2"><a aria-hidden="true" href="#cb21-2" tabindex="-1"></a><span class="co"># Note: calculate_estimates() expects columns named 'completed_catch' and 'trip_length'</span></span>
<span id="cb21-3"><a aria-hidden="true" href="#cb21-3" tabindex="-1"></a>roving_data <span class="ot">&lt;-</span> roving_sample <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a aria-hidden="true" href="#cb21-4" tabindex="-1"></a>  <span class="fu">select</span>(angler_id,</span>
<span id="cb21-5"><a aria-hidden="true" href="#cb21-5" tabindex="-1"></a>         <span class="at">completed_catch =</span> catch_at_interview,</span>
<span id="cb21-6"><a aria-hidden="true" href="#cb21-6" tabindex="-1"></a>         <span class="at">trip_length =</span> time_at_interview,</span>
<span id="cb21-7"><a aria-hidden="true" href="#cb21-7" tabindex="-1"></a>         true_population_rate)</span>
<span id="cb21-8"><a aria-hidden="true" href="#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a aria-hidden="true" href="#cb21-9" tabindex="-1"></a><span class="co"># No truncation</span></span>
<span id="cb21-10"><a aria-hidden="true" href="#cb21-10" tabindex="-1"></a>roving_no_trunc <span class="ot">&lt;-</span> <span class="fu">calculate_estimates</span>(roving_data, <span class="at">truncate_minutes =</span> <span class="cn">NULL</span>)</span>
<span id="cb21-11"><a aria-hidden="true" href="#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a aria-hidden="true" href="#cb21-12" tabindex="-1"></a><span class="co"># With truncation (30 minutes)</span></span>
<span id="cb21-13"><a aria-hidden="true" href="#cb21-13" tabindex="-1"></a>roving_with_trunc <span class="ot">&lt;-</span> <span class="fu">calculate_estimates</span>(roving_data, <span class="at">truncate_minutes =</span> <span class="dv">30</span>)</span>
<span id="cb21-14"><a aria-hidden="true" href="#cb21-14" tabindex="-1"></a></span>
<span id="cb21-15"><a aria-hidden="true" href="#cb21-15" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb21-16"><a aria-hidden="true" href="#cb21-16" tabindex="-1"></a>  roving_no_trunc <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">truncation =</span> <span class="st">"None"</span>),</span>
<span id="cb21-17"><a aria-hidden="true" href="#cb21-17" tabindex="-1"></a>  roving_with_trunc <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">truncation =</span> <span class="st">"30 min"</span>)</span>
<span id="cb21-18"><a aria-hidden="true" href="#cb21-18" tabindex="-1"></a>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
      n ratio_of_means mean_of_ratios se_r1 se_r2 true_rate truncation
  &lt;int&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     
1    30           1.98           1.77 0.329 0.289      2.15 None      
2    27           1.97           1.67 0.334 0.281      2.15 30 min    </code></pre>
</div>
</div>
</section>
<section class="level3" id="monte-carlo-simulation">
<h3 class="anchored" data-anchor-id="monte-carlo-simulation">Monte Carlo Simulation</h3>
<p>Run 1000 replications to assess bias and precision.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a aria-hidden="true" href="#cb23-1" tabindex="-1"></a>run_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_reps =</span> <span class="dv">1000</span>,</span>
<span id="cb23-2"><a aria-hidden="true" href="#cb23-2" tabindex="-1"></a>                           <span class="at">n_anglers =</span> <span class="dv">100</span>,</span>
<span id="cb23-3"><a aria-hidden="true" href="#cb23-3" tabindex="-1"></a>                           <span class="at">n_interviews =</span> <span class="dv">30</span>,</span>
<span id="cb23-4"><a aria-hidden="true" href="#cb23-4" tabindex="-1"></a>                           <span class="at">interview_type =</span> <span class="fu">c</span>(<span class="st">"access"</span>, <span class="st">"roving"</span>)) {</span>
<span id="cb23-5"><a aria-hidden="true" href="#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a aria-hidden="true" href="#cb23-6" tabindex="-1"></a>  interview_type <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(interview_type)</span>
<span id="cb23-7"><a aria-hidden="true" href="#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a aria-hidden="true" href="#cb23-8" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>n_reps, <span class="cf">function</span>(rep) {</span>
<span id="cb23-9"><a aria-hidden="true" href="#cb23-9" tabindex="-1"></a>    <span class="co"># Generate population</span></span>
<span id="cb23-10"><a aria-hidden="true" href="#cb23-10" tabindex="-1"></a>    day <span class="ot">&lt;-</span> <span class="fu">simulate_fishing_day</span>(<span class="at">n_anglers =</span> n_anglers)</span>
<span id="cb23-11"><a aria-hidden="true" href="#cb23-11" tabindex="-1"></a>    true_rate <span class="ot">&lt;-</span> day<span class="sc">$</span>true_population_rate[<span class="dv">1</span>]</span>
<span id="cb23-12"><a aria-hidden="true" href="#cb23-12" tabindex="-1"></a></span>
<span id="cb23-13"><a aria-hidden="true" href="#cb23-13" tabindex="-1"></a>    <span class="co"># Sample based on design</span></span>
<span id="cb23-14"><a aria-hidden="true" href="#cb23-14" tabindex="-1"></a>    <span class="cf">if</span> (interview_type <span class="sc">==</span> <span class="st">"access"</span>) {</span>
<span id="cb23-15"><a aria-hidden="true" href="#cb23-15" tabindex="-1"></a>      sample_data <span class="ot">&lt;-</span> <span class="fu">sample_access_interviews</span>(day, n_interviews)</span>
<span id="cb23-16"><a aria-hidden="true" href="#cb23-16" tabindex="-1"></a>      sample_data <span class="ot">&lt;-</span> sample_data <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a aria-hidden="true" href="#cb23-17" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">catch =</span> completed_catch, <span class="at">effort =</span> trip_length)</span>
<span id="cb23-18"><a aria-hidden="true" href="#cb23-18" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-19"><a aria-hidden="true" href="#cb23-19" tabindex="-1"></a>      sample_data <span class="ot">&lt;-</span> <span class="fu">sample_roving_interviews</span>(day, n_interviews) <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a aria-hidden="true" href="#cb23-20" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">catch =</span> catch_at_interview, <span class="at">effort =</span> time_at_interview)</span>
<span id="cb23-21"><a aria-hidden="true" href="#cb23-21" tabindex="-1"></a>    }</span>
<span id="cb23-22"><a aria-hidden="true" href="#cb23-22" tabindex="-1"></a></span>
<span id="cb23-23"><a aria-hidden="true" href="#cb23-23" tabindex="-1"></a>    <span class="co"># Calculate estimators</span></span>
<span id="cb23-24"><a aria-hidden="true" href="#cb23-24" tabindex="-1"></a>    <span class="co"># No truncation</span></span>
<span id="cb23-25"><a aria-hidden="true" href="#cb23-25" tabindex="-1"></a>    r1_no <span class="ot">&lt;-</span> <span class="fu">sum</span>(sample_data<span class="sc">$</span>catch) <span class="sc">/</span> <span class="fu">sum</span>(sample_data<span class="sc">$</span>effort)</span>
<span id="cb23-26"><a aria-hidden="true" href="#cb23-26" tabindex="-1"></a>    r2_no <span class="ot">&lt;-</span> <span class="fu">mean</span>(sample_data<span class="sc">$</span>catch <span class="sc">/</span> sample_data<span class="sc">$</span>effort)</span>
<span id="cb23-27"><a aria-hidden="true" href="#cb23-27" tabindex="-1"></a></span>
<span id="cb23-28"><a aria-hidden="true" href="#cb23-28" tabindex="-1"></a>    <span class="co"># With truncation (30 min = 0.5 hr)</span></span>
<span id="cb23-29"><a aria-hidden="true" href="#cb23-29" tabindex="-1"></a>    trunc_data <span class="ot">&lt;-</span> sample_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(effort <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb23-30"><a aria-hidden="true" href="#cb23-30" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(trunc_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb23-31"><a aria-hidden="true" href="#cb23-31" tabindex="-1"></a>      r1_trunc <span class="ot">&lt;-</span> <span class="fu">sum</span>(trunc_data<span class="sc">$</span>catch) <span class="sc">/</span> <span class="fu">sum</span>(trunc_data<span class="sc">$</span>effort)</span>
<span id="cb23-32"><a aria-hidden="true" href="#cb23-32" tabindex="-1"></a>      r2_trunc <span class="ot">&lt;-</span> <span class="fu">mean</span>(trunc_data<span class="sc">$</span>catch <span class="sc">/</span> trunc_data<span class="sc">$</span>effort)</span>
<span id="cb23-33"><a aria-hidden="true" href="#cb23-33" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-34"><a aria-hidden="true" href="#cb23-34" tabindex="-1"></a>      r1_trunc <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-35"><a aria-hidden="true" href="#cb23-35" tabindex="-1"></a>      r2_trunc <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-36"><a aria-hidden="true" href="#cb23-36" tabindex="-1"></a>    }</span>
<span id="cb23-37"><a aria-hidden="true" href="#cb23-37" tabindex="-1"></a></span>
<span id="cb23-38"><a aria-hidden="true" href="#cb23-38" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb23-39"><a aria-hidden="true" href="#cb23-39" tabindex="-1"></a>      <span class="at">rep =</span> rep,</span>
<span id="cb23-40"><a aria-hidden="true" href="#cb23-40" tabindex="-1"></a>      <span class="at">true_rate =</span> true_rate,</span>
<span id="cb23-41"><a aria-hidden="true" href="#cb23-41" tabindex="-1"></a>      <span class="at">r1_no_trunc =</span> r1_no,</span>
<span id="cb23-42"><a aria-hidden="true" href="#cb23-42" tabindex="-1"></a>      <span class="at">r2_no_trunc =</span> r2_no,</span>
<span id="cb23-43"><a aria-hidden="true" href="#cb23-43" tabindex="-1"></a>      <span class="at">r1_with_trunc =</span> r1_trunc,</span>
<span id="cb23-44"><a aria-hidden="true" href="#cb23-44" tabindex="-1"></a>      <span class="at">r2_with_trunc =</span> r2_trunc,</span>
<span id="cb23-45"><a aria-hidden="true" href="#cb23-45" tabindex="-1"></a>      <span class="at">n_interviews =</span> n_interviews,</span>
<span id="cb23-46"><a aria-hidden="true" href="#cb23-46" tabindex="-1"></a>      <span class="at">n_after_trunc =</span> <span class="fu">nrow</span>(trunc_data)</span>
<span id="cb23-47"><a aria-hidden="true" href="#cb23-47" tabindex="-1"></a>    )</span>
<span id="cb23-48"><a aria-hidden="true" href="#cb23-48" tabindex="-1"></a>  })</span>
<span id="cb23-49"><a aria-hidden="true" href="#cb23-49" tabindex="-1"></a></span>
<span id="cb23-50"><a aria-hidden="true" href="#cb23-50" tabindex="-1"></a>  results <span class="sc">%&gt;%</span></span>
<span id="cb23-51"><a aria-hidden="true" href="#cb23-51" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">design =</span> interview_type)</span>
<span id="cb23-52"><a aria-hidden="true" href="#cb23-52" tabindex="-1"></a>}</span>
<span id="cb23-53"><a aria-hidden="true" href="#cb23-53" tabindex="-1"></a></span>
<span id="cb23-54"><a aria-hidden="true" href="#cb23-54" tabindex="-1"></a><span class="co"># Run simulations</span></span>
<span id="cb23-55"><a aria-hidden="true" href="#cb23-55" tabindex="-1"></a>access_mc <span class="ot">&lt;-</span> <span class="fu">run_simulation</span>(<span class="at">n_reps =</span> <span class="dv">1000</span>, <span class="at">interview_type =</span> <span class="st">"access"</span>)</span>
<span id="cb23-56"><a aria-hidden="true" href="#cb23-56" tabindex="-1"></a>roving_mc <span class="ot">&lt;-</span> <span class="fu">run_simulation</span>(<span class="at">n_reps =</span> <span class="dv">1000</span>, <span class="at">interview_type =</span> <span class="st">"roving"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
</div>
</section>
<section class="level3" id="results-access-point-design">
<h3 class="anchored" data-anchor-id="results-access-point-design">Results: Access Point Design</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a aria-hidden="true" href="#cb24-1" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb24-2"><a aria-hidden="true" href="#cb24-2" tabindex="-1"></a>access_summary <span class="ot">&lt;-</span> access_mc <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a aria-hidden="true" href="#cb24-3" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb24-4"><a aria-hidden="true" href="#cb24-4" tabindex="-1"></a>    <span class="at">true_rate =</span> <span class="fu">mean</span>(true_rate),</span>
<span id="cb24-5"><a aria-hidden="true" href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a aria-hidden="true" href="#cb24-6" tabindex="-1"></a>    <span class="co"># Ratio of means (R1)</span></span>
<span id="cb24-7"><a aria-hidden="true" href="#cb24-7" tabindex="-1"></a>    <span class="at">r1_mean =</span> <span class="fu">mean</span>(r1_no_trunc),</span>
<span id="cb24-8"><a aria-hidden="true" href="#cb24-8" tabindex="-1"></a>    <span class="at">r1_bias =</span> <span class="fu">mean</span>(r1_no_trunc <span class="sc">-</span> true_rate),</span>
<span id="cb24-9"><a aria-hidden="true" href="#cb24-9" tabindex="-1"></a>    <span class="at">r1_pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((r1_no_trunc <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate),</span>
<span id="cb24-10"><a aria-hidden="true" href="#cb24-10" tabindex="-1"></a>    <span class="at">r1_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((r1_no_trunc <span class="sc">-</span> true_rate)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb24-11"><a aria-hidden="true" href="#cb24-11" tabindex="-1"></a>    <span class="at">r1_se =</span> <span class="fu">sd</span>(r1_no_trunc),</span>
<span id="cb24-12"><a aria-hidden="true" href="#cb24-12" tabindex="-1"></a></span>
<span id="cb24-13"><a aria-hidden="true" href="#cb24-13" tabindex="-1"></a>    <span class="co"># Mean of ratios (R2)</span></span>
<span id="cb24-14"><a aria-hidden="true" href="#cb24-14" tabindex="-1"></a>    <span class="at">r2_mean =</span> <span class="fu">mean</span>(r2_no_trunc),</span>
<span id="cb24-15"><a aria-hidden="true" href="#cb24-15" tabindex="-1"></a>    <span class="at">r2_bias =</span> <span class="fu">mean</span>(r2_no_trunc <span class="sc">-</span> true_rate),</span>
<span id="cb24-16"><a aria-hidden="true" href="#cb24-16" tabindex="-1"></a>    <span class="at">r2_pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((r2_no_trunc <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate),</span>
<span id="cb24-17"><a aria-hidden="true" href="#cb24-17" tabindex="-1"></a>    <span class="at">r2_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((r2_no_trunc <span class="sc">-</span> true_rate)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb24-18"><a aria-hidden="true" href="#cb24-18" tabindex="-1"></a>    <span class="at">r2_se =</span> <span class="fu">sd</span>(r2_no_trunc)</span>
<span id="cb24-19"><a aria-hidden="true" href="#cb24-19" tabindex="-1"></a>  )</span>
<span id="cb24-20"><a aria-hidden="true" href="#cb24-20" tabindex="-1"></a></span>
<span id="cb24-21"><a aria-hidden="true" href="#cb24-21" tabindex="-1"></a>access_summary <span class="sc">%&gt;%</span></span>
<span id="cb24-22"><a aria-hidden="true" href="#cb24-22" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>true_rate, <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"estimator"</span>, <span class="st">"metric"</span>), <span class="at">names_sep =</span> <span class="st">"_"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>, <span class="at">names_repair =</span> <span class="st">"minimal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-23"><a aria-hidden="true" href="#cb24-23" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> metric, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb24-24"><a aria-hidden="true" href="#cb24-24" tabindex="-1"></a>  <span class="fu">select</span>(estimator, mean, bias, pct, se, rmse) <span class="sc">%&gt;%</span></span>
<span id="cb24-25"><a aria-hidden="true" href="#cb24-25" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pct_bias =</span> pct) <span class="sc">%&gt;%</span></span>
<span id="cb24-26"><a aria-hidden="true" href="#cb24-26" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">4</span>, <span class="at">caption =</span> <span class="st">"Access Point Design: Estimator Performance"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Access Point Design: Estimator Performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;">estimator</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">bias</th>
<th style="text-align: right;">pct_bias</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">rmse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">r1</td>
<td style="text-align: right;">1.9953</td>
<td style="text-align: right;">-0.0069</td>
<td style="text-align: right;">-0.3452</td>
<td style="text-align: right;">0.4276</td>
<td style="text-align: right;">0.4274</td>
</tr>
<tr class="even">
<td style="text-align: left;">r2</td>
<td style="text-align: right;">2.0081</td>
<td style="text-align: right;">0.0059</td>
<td style="text-align: right;">0.2955</td>
<td style="text-align: right;">0.4081</td>
<td style="text-align: right;">0.4079</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Key Finding:</strong> For access interviews, <strong>both estimators are approximately unbiased</strong>, but ratio-of-means (R₁) typically has slightly lower variance.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a aria-hidden="true" href="#cb25-1" tabindex="-1"></a>access_mc <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a aria-hidden="true" href="#cb25-2" tabindex="-1"></a>  <span class="fu">select</span>(rep, true_rate, r1_no_trunc, r2_no_trunc) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a aria-hidden="true" href="#cb25-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(r1_no_trunc, r2_no_trunc),</span>
<span id="cb25-4"><a aria-hidden="true" href="#cb25-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"estimator"</span>,</span>
<span id="cb25-5"><a aria-hidden="true" href="#cb25-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"estimate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a aria-hidden="true" href="#cb25-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="fu">recode</span>(estimator,</span>
<span id="cb25-7"><a aria-hidden="true" href="#cb25-7" tabindex="-1"></a>                            <span class="at">r1_no_trunc =</span> <span class="st">"Ratio of Means (R₁)"</span>,</span>
<span id="cb25-8"><a aria-hidden="true" href="#cb25-8" tabindex="-1"></a>                            <span class="at">r2_no_trunc =</span> <span class="st">"Mean of Ratios (R₂)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a aria-hidden="true" href="#cb25-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">fill =</span> estimator)) <span class="sc">+</span></span>
<span id="cb25-10"><a aria-hidden="true" href="#cb25-10" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb25-11"><a aria-hidden="true" href="#cb25-11" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(true_rate)), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-12"><a aria-hidden="true" href="#cb25-12" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimator, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-13"><a aria-hidden="true" href="#cb25-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Access Point Design: Sampling Distribution"</span>,</span>
<span id="cb25-14"><a aria-hidden="true" href="#cb25-14" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Dashed line = true population catch rate"</span>,</span>
<span id="cb25-15"><a aria-hidden="true" href="#cb25-15" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Estimated Catch Rate (fish/hour)"</span>,</span>
<span id="cb25-16"><a aria-hidden="true" href="#cb25-16" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb25-17"><a aria-hidden="true" href="#cb25-17" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-18"><a aria-hidden="true" href="#cb25-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img class="img-fluid figure-img" src="ratio-estimators-guide_files/figure-html/access-plot-1.png" width="768"/></p>
<figcaption>Access Point Design: Distribution of Estimates. Both estimators center on the true value (dashed line), demonstrating unbiasedness. The ratio-of-means (R₁) shows slightly tighter clustering, indicating lower variance.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="results-roving-design">
<h3 class="anchored" data-anchor-id="results-roving-design">Results: Roving Design</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a aria-hidden="true" href="#cb26-1" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb26-2"><a aria-hidden="true" href="#cb26-2" tabindex="-1"></a>roving_summary <span class="ot">&lt;-</span> roving_mc <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a aria-hidden="true" href="#cb26-3" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb26-4"><a aria-hidden="true" href="#cb26-4" tabindex="-1"></a>    <span class="at">true_rate =</span> <span class="fu">mean</span>(true_rate),</span>
<span id="cb26-5"><a aria-hidden="true" href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a aria-hidden="true" href="#cb26-6" tabindex="-1"></a>    <span class="co"># R1 no truncation</span></span>
<span id="cb26-7"><a aria-hidden="true" href="#cb26-7" tabindex="-1"></a>    <span class="at">r1_no_mean =</span> <span class="fu">mean</span>(r1_no_trunc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-8"><a aria-hidden="true" href="#cb26-8" tabindex="-1"></a>    <span class="at">r1_no_bias =</span> <span class="fu">mean</span>(r1_no_trunc <span class="sc">-</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-9"><a aria-hidden="true" href="#cb26-9" tabindex="-1"></a>    <span class="at">r1_no_pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((r1_no_trunc <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-10"><a aria-hidden="true" href="#cb26-10" tabindex="-1"></a>    <span class="at">r1_no_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((r1_no_trunc <span class="sc">-</span> true_rate)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb26-11"><a aria-hidden="true" href="#cb26-11" tabindex="-1"></a></span>
<span id="cb26-12"><a aria-hidden="true" href="#cb26-12" tabindex="-1"></a>    <span class="co"># R2 no truncation</span></span>
<span id="cb26-13"><a aria-hidden="true" href="#cb26-13" tabindex="-1"></a>    <span class="at">r2_no_mean =</span> <span class="fu">mean</span>(r2_no_trunc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-14"><a aria-hidden="true" href="#cb26-14" tabindex="-1"></a>    <span class="at">r2_no_bias =</span> <span class="fu">mean</span>(r2_no_trunc <span class="sc">-</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-15"><a aria-hidden="true" href="#cb26-15" tabindex="-1"></a>    <span class="at">r2_no_pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((r2_no_trunc <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-16"><a aria-hidden="true" href="#cb26-16" tabindex="-1"></a>    <span class="at">r2_no_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((r2_no_trunc <span class="sc">-</span> true_rate)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb26-17"><a aria-hidden="true" href="#cb26-17" tabindex="-1"></a></span>
<span id="cb26-18"><a aria-hidden="true" href="#cb26-18" tabindex="-1"></a>    <span class="co"># R1 with truncation</span></span>
<span id="cb26-19"><a aria-hidden="true" href="#cb26-19" tabindex="-1"></a>    <span class="at">r1_trunc_mean =</span> <span class="fu">mean</span>(r1_with_trunc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-20"><a aria-hidden="true" href="#cb26-20" tabindex="-1"></a>    <span class="at">r1_trunc_bias =</span> <span class="fu">mean</span>(r1_with_trunc <span class="sc">-</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-21"><a aria-hidden="true" href="#cb26-21" tabindex="-1"></a>    <span class="at">r1_trunc_pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((r1_with_trunc <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-22"><a aria-hidden="true" href="#cb26-22" tabindex="-1"></a>    <span class="at">r1_trunc_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((r1_with_trunc <span class="sc">-</span> true_rate)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb26-23"><a aria-hidden="true" href="#cb26-23" tabindex="-1"></a></span>
<span id="cb26-24"><a aria-hidden="true" href="#cb26-24" tabindex="-1"></a>    <span class="co"># R2 with truncation</span></span>
<span id="cb26-25"><a aria-hidden="true" href="#cb26-25" tabindex="-1"></a>    <span class="at">r2_trunc_mean =</span> <span class="fu">mean</span>(r2_with_trunc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-26"><a aria-hidden="true" href="#cb26-26" tabindex="-1"></a>    <span class="at">r2_trunc_bias =</span> <span class="fu">mean</span>(r2_with_trunc <span class="sc">-</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-27"><a aria-hidden="true" href="#cb26-27" tabindex="-1"></a>    <span class="at">r2_trunc_pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((r2_with_trunc <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-28"><a aria-hidden="true" href="#cb26-28" tabindex="-1"></a>    <span class="at">r2_trunc_rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((r2_with_trunc <span class="sc">-</span> true_rate)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb26-29"><a aria-hidden="true" href="#cb26-29" tabindex="-1"></a>  )</span>
<span id="cb26-30"><a aria-hidden="true" href="#cb26-30" tabindex="-1"></a></span>
<span id="cb26-31"><a aria-hidden="true" href="#cb26-31" tabindex="-1"></a>roving_summary <span class="sc">%&gt;%</span></span>
<span id="cb26-32"><a aria-hidden="true" href="#cb26-32" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>true_rate,</span>
<span id="cb26-33"><a aria-hidden="true" href="#cb26-33" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"estimator"</span>, <span class="st">"truncation"</span>, <span class="st">"metric"</span>),</span>
<span id="cb26-34"><a aria-hidden="true" href="#cb26-34" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"([^_]+)_([^_]+)_(.*)"</span>,</span>
<span id="cb26-35"><a aria-hidden="true" href="#cb26-35" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-36"><a aria-hidden="true" href="#cb26-36" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> metric, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb26-37"><a aria-hidden="true" href="#cb26-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="fu">recode</span>(estimator, <span class="at">r1 =</span> <span class="st">"Ratio of Means"</span>, <span class="at">r2 =</span> <span class="st">"Mean of Ratios"</span>),</span>
<span id="cb26-38"><a aria-hidden="true" href="#cb26-38" tabindex="-1"></a>         <span class="at">truncation =</span> <span class="fu">recode</span>(truncation, <span class="at">no =</span> <span class="st">"No truncation"</span>, <span class="at">trunc =</span> <span class="st">"30-min truncation"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-39"><a aria-hidden="true" href="#cb26-39" tabindex="-1"></a>  <span class="fu">select</span>(estimator, truncation, mean, bias, pct_bias, rmse) <span class="sc">%&gt;%</span></span>
<span id="cb26-40"><a aria-hidden="true" href="#cb26-40" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">4</span>, <span class="at">caption =</span> <span class="st">"Roving Design: Estimator Performance"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Roving Design: Estimator Performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;">estimator</th>
<th style="text-align: left;">truncation</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">bias</th>
<th style="text-align: right;">pct_bias</th>
<th style="text-align: right;">rmse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ratio of Means</td>
<td style="text-align: left;">No truncation</td>
<td style="text-align: right;">1.9957</td>
<td style="text-align: right;">-0.0209</td>
<td style="text-align: right;">-1.0341</td>
<td style="text-align: right;">0.4985</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean of Ratios</td>
<td style="text-align: left;">No truncation</td>
<td style="text-align: right;">1.9909</td>
<td style="text-align: right;">-0.0256</td>
<td style="text-align: right;">-1.2698</td>
<td style="text-align: right;">0.4629</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ratio of Means</td>
<td style="text-align: left;">30-min truncation</td>
<td style="text-align: right;">1.9966</td>
<td style="text-align: right;">-0.0199</td>
<td style="text-align: right;">-0.9880</td>
<td style="text-align: right;">0.5041</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean of Ratios</td>
<td style="text-align: left;">30-min truncation</td>
<td style="text-align: right;">2.0092</td>
<td style="text-align: right;">-0.0073</td>
<td style="text-align: right;">-0.3629</td>
<td style="text-align: right;">0.4400</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Key Findings:</strong></p>
<ol type="1">
<li><strong>R₁ (ratio-of-means) is BIASED for roving interviews</strong> - does not estimate population catch rate</li>
<li><strong>R₂ (mean-of-ratios) without truncation is approximately unbiased BUT has high variance</strong> (unstable)</li>
<li><strong>R₂ with truncation is approximately unbiased AND has lower variance</strong> ✓ <strong>RECOMMENDED</strong></li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a aria-hidden="true" href="#cb27-1" tabindex="-1"></a>roving_mc <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a aria-hidden="true" href="#cb27-2" tabindex="-1"></a>  <span class="fu">select</span>(rep, true_rate, r1_no_trunc, r2_no_trunc, r1_with_trunc, r2_with_trunc) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a aria-hidden="true" href="#cb27-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(rep, true_rate),</span>
<span id="cb27-4"><a aria-hidden="true" href="#cb27-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"estimator"</span>,</span>
<span id="cb27-5"><a aria-hidden="true" href="#cb27-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"estimate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a aria-hidden="true" href="#cb27-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a aria-hidden="true" href="#cb27-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-8"><a aria-hidden="true" href="#cb27-8" tabindex="-1"></a>    <span class="at">estimator_type =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"r1"</span>, estimator), <span class="st">"Ratio of Means (R₁)"</span>, <span class="st">"Mean of Ratios (R₂)"</span>),</span>
<span id="cb27-9"><a aria-hidden="true" href="#cb27-9" tabindex="-1"></a>    <span class="at">truncation =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"no_trunc"</span>, estimator), <span class="st">"No Truncation"</span>, <span class="st">"30-Min Truncation"</span>)</span>
<span id="cb27-10"><a aria-hidden="true" href="#cb27-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a aria-hidden="true" href="#cb27-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">fill =</span> truncation)) <span class="sc">+</span></span>
<span id="cb27-12"><a aria-hidden="true" href="#cb27-12" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb27-13"><a aria-hidden="true" href="#cb27-13" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(true_rate)), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a aria-hidden="true" href="#cb27-14" tabindex="-1"></a>  <span class="fu">facet_grid</span>(estimator_type <span class="sc">~</span> truncation, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a aria-hidden="true" href="#cb27-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Roving Design: Impact of Estimator Choice and Truncation"</span>,</span>
<span id="cb27-16"><a aria-hidden="true" href="#cb27-16" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Dashed line = true population catch rate"</span>,</span>
<span id="cb27-17"><a aria-hidden="true" href="#cb27-17" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Estimated Catch Rate (fish/hour)"</span>,</span>
<span id="cb27-18"><a aria-hidden="true" href="#cb27-18" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb27-19"><a aria-hidden="true" href="#cb27-19" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Truncation"</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a aria-hidden="true" href="#cb27-20" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-21"><a aria-hidden="true" href="#cb27-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img class="img-fluid figure-img" src="ratio-estimators-guide_files/figure-html/roving-plot-1.png" width="768"/></p>
<figcaption>Roving Design: Effect of Truncation. R₁ (ratio-of-means) is biased for roving surveys regardless of truncation. R₂ (mean-of-ratios) is unbiased but has high variance without truncation; truncation reduces variance while maintaining unbiasedness.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section class="level2" id="practical-implementation-with-tidycreel">
<h2 class="anchored" data-anchor-id="practical-implementation-with-tidycreel">Practical Implementation with tidycreel</h2>
<section class="level3" id="access-point-survey-example">
<h3 class="anchored" data-anchor-id="access-point-survey-example">Access Point Survey Example</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a aria-hidden="true" href="#cb28-1" tabindex="-1"></a><span class="co"># Assuming you have complete-trip interview data</span></span>
<span id="cb28-2"><a aria-hidden="true" href="#cb28-2" tabindex="-1"></a>interviews_complete <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb28-3"><a aria-hidden="true" href="#cb28-3" tabindex="-1"></a>  <span class="at">angler_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb28-4"><a aria-hidden="true" href="#cb28-4" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">each =</span> <span class="dv">10</span>),</span>
<span id="cb28-5"><a aria-hidden="true" href="#cb28-5" tabindex="-1"></a>  <span class="at">catch_total =</span> <span class="fu">rpois</span>(<span class="dv">100</span>, <span class="at">lambda =</span> <span class="dv">8</span>),</span>
<span id="cb28-6"><a aria-hidden="true" href="#cb28-6" tabindex="-1"></a>  <span class="at">hours_fished =</span> <span class="fu">rgamma</span>(<span class="dv">100</span>, <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">rate =</span> <span class="dv">1</span>),</span>
<span id="cb28-7"><a aria-hidden="true" href="#cb28-7" tabindex="-1"></a>  <span class="at">day_type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"weekday"</span>, <span class="st">"weekend"</span>), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb28-8"><a aria-hidden="true" href="#cb28-8" tabindex="-1"></a>)</span>
<span id="cb28-9"><a aria-hidden="true" href="#cb28-9" tabindex="-1"></a></span>
<span id="cb28-10"><a aria-hidden="true" href="#cb28-10" tabindex="-1"></a><span class="co"># Create survey design</span></span>
<span id="cb28-11"><a aria-hidden="true" href="#cb28-11" tabindex="-1"></a>svy_interviews <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(</span>
<span id="cb28-12"><a aria-hidden="true" href="#cb28-12" tabindex="-1"></a>  <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb28-13"><a aria-hidden="true" href="#cb28-13" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>day_type,</span>
<span id="cb28-14"><a aria-hidden="true" href="#cb28-14" tabindex="-1"></a>  <span class="at">data =</span> interviews_complete</span>
<span id="cb28-15"><a aria-hidden="true" href="#cb28-15" tabindex="-1"></a>)</span>
<span id="cb28-16"><a aria-hidden="true" href="#cb28-16" tabindex="-1"></a></span>
<span id="cb28-17"><a aria-hidden="true" href="#cb28-17" tabindex="-1"></a><span class="co"># Use RATIO-OF-MEANS (default and recommended)</span></span>
<span id="cb28-18"><a aria-hidden="true" href="#cb28-18" tabindex="-1"></a>cpue_access <span class="ot">&lt;-</span> <span class="fu">est_cpue</span>(</span>
<span id="cb28-19"><a aria-hidden="true" href="#cb28-19" tabindex="-1"></a>  <span class="at">design =</span> svy_interviews,</span>
<span id="cb28-20"><a aria-hidden="true" href="#cb28-20" tabindex="-1"></a>  <span class="at">by =</span> <span class="cn">NULL</span>,</span>
<span id="cb28-21"><a aria-hidden="true" href="#cb28-21" tabindex="-1"></a>  <span class="at">response =</span> <span class="st">"catch_total"</span>,</span>
<span id="cb28-22"><a aria-hidden="true" href="#cb28-22" tabindex="-1"></a>  <span class="at">effort_col =</span> <span class="st">"hours_fished"</span>,</span>
<span id="cb28-23"><a aria-hidden="true" href="#cb28-23" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"ratio_of_means"</span>  <span class="co"># ✓ Correct for access interviews</span></span>
<span id="cb28-24"><a aria-hidden="true" href="#cb28-24" tabindex="-1"></a>)</span>
<span id="cb28-25"><a aria-hidden="true" href="#cb28-25" tabindex="-1"></a></span>
<span id="cb28-26"><a aria-hidden="true" href="#cb28-26" tabindex="-1"></a>cpue_access</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
</div>
</section>
<section class="level3" id="roving-survey-example">
<h3 class="anchored" data-anchor-id="roving-survey-example">Roving Survey Example</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a aria-hidden="true" href="#cb29-1" tabindex="-1"></a><span class="co"># Assuming you have incomplete-trip interview data</span></span>
<span id="cb29-2"><a aria-hidden="true" href="#cb29-2" tabindex="-1"></a>interviews_incomplete <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb29-3"><a aria-hidden="true" href="#cb29-3" tabindex="-1"></a>  <span class="at">angler_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb29-4"><a aria-hidden="true" href="#cb29-4" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">each =</span> <span class="dv">10</span>),</span>
<span id="cb29-5"><a aria-hidden="true" href="#cb29-5" tabindex="-1"></a>  <span class="at">catch_total =</span> <span class="fu">rpois</span>(<span class="dv">100</span>, <span class="at">lambda =</span> <span class="dv">4</span>),  <span class="co"># Catch so far</span></span>
<span id="cb29-6"><a aria-hidden="true" href="#cb29-6" tabindex="-1"></a>  <span class="at">hours_fished =</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="at">min =</span> <span class="fl">0.2</span>, <span class="at">max =</span> <span class="dv">6</span>),  <span class="co"># Time so far</span></span>
<span id="cb29-7"><a aria-hidden="true" href="#cb29-7" tabindex="-1"></a>  <span class="at">day_type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"weekday"</span>, <span class="st">"weekend"</span>), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb29-8"><a aria-hidden="true" href="#cb29-8" tabindex="-1"></a>)</span>
<span id="cb29-9"><a aria-hidden="true" href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a aria-hidden="true" href="#cb29-10" tabindex="-1"></a><span class="co"># IMPORTANT: Truncate short trips before analysis</span></span>
<span id="cb29-11"><a aria-hidden="true" href="#cb29-11" tabindex="-1"></a>interviews_truncated <span class="ot">&lt;-</span> interviews_incomplete <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a aria-hidden="true" href="#cb29-12" tabindex="-1"></a>  <span class="fu">filter</span>(hours_fished <span class="sc">&gt;=</span> <span class="fl">0.5</span>)  <span class="co"># Remove trips &lt; 30 minutes</span></span>
<span id="cb29-13"><a aria-hidden="true" href="#cb29-13" tabindex="-1"></a></span>
<span id="cb29-14"><a aria-hidden="true" href="#cb29-14" tabindex="-1"></a><span class="co"># Create survey design</span></span>
<span id="cb29-15"><a aria-hidden="true" href="#cb29-15" tabindex="-1"></a>svy_roving <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(</span>
<span id="cb29-16"><a aria-hidden="true" href="#cb29-16" tabindex="-1"></a>  <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb29-17"><a aria-hidden="true" href="#cb29-17" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>day_type,</span>
<span id="cb29-18"><a aria-hidden="true" href="#cb29-18" tabindex="-1"></a>  <span class="at">data =</span> interviews_truncated</span>
<span id="cb29-19"><a aria-hidden="true" href="#cb29-19" tabindex="-1"></a>)</span>
<span id="cb29-20"><a aria-hidden="true" href="#cb29-20" tabindex="-1"></a></span>
<span id="cb29-21"><a aria-hidden="true" href="#cb29-21" tabindex="-1"></a><span class="co"># Use MEAN-OF-RATIOS for roving interviews</span></span>
<span id="cb29-22"><a aria-hidden="true" href="#cb29-22" tabindex="-1"></a>cpue_roving <span class="ot">&lt;-</span> <span class="fu">est_cpue</span>(</span>
<span id="cb29-23"><a aria-hidden="true" href="#cb29-23" tabindex="-1"></a>  <span class="at">design =</span> svy_roving,</span>
<span id="cb29-24"><a aria-hidden="true" href="#cb29-24" tabindex="-1"></a>  <span class="at">by =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-25"><a aria-hidden="true" href="#cb29-25" tabindex="-1"></a>  <span class="at">response =</span> <span class="st">"catch_total"</span>,</span>
<span id="cb29-26"><a aria-hidden="true" href="#cb29-26" tabindex="-1"></a>  <span class="at">effort_col =</span> <span class="st">"hours_fished"</span>,</span>
<span id="cb29-27"><a aria-hidden="true" href="#cb29-27" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"mean_of_ratios"</span>  <span class="co"># ✓ Correct for roving interviews</span></span>
<span id="cb29-28"><a aria-hidden="true" href="#cb29-28" tabindex="-1"></a>)</span>
<span id="cb29-29"><a aria-hidden="true" href="#cb29-29" tabindex="-1"></a></span>
<span id="cb29-30"><a aria-hidden="true" href="#cb29-30" tabindex="-1"></a>cpue_roving</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section class="level2" id="variance-estimation">
<h2 class="anchored" data-anchor-id="variance-estimation">Variance Estimation</h2>
<section class="level3" id="access-point-ratio-of-means">
<h3 class="anchored" data-anchor-id="access-point-ratio-of-means">Access Point (Ratio-of-Means)</h3>
<p>For ratio-of-means with survey weights, the <code>survey</code> package automatically uses the delta method:</p>
<p><strong>Note:</strong> These variance formulas assume sampling from an infinite (or very large) population. If your sample size is substantial relative to the total number of anglers (n/N &gt; 5%), you may want to apply a finite population correction (FPC): multiply the variance by (1 - n/N). However, for most creel surveys where the population of potential anglers is large, this correction is negligible.</p>
<p><span class="math display">\[\text{Var}(\hat{R}_1) \approx \frac{1}{n\bar{E}^2} \text{Var}(C - \hat{R}_1 E)\]</span></p>
<p>where <span class="math inline">\(C\)</span> = catch, <span class="math inline">\(E\)</span> = effort.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a aria-hidden="true" href="#cb30-1" tabindex="-1"></a><span class="co"># survey::svyratio() provides proper variance</span></span>
<span id="cb30-2"><a aria-hidden="true" href="#cb30-2" tabindex="-1"></a>cpue_result <span class="ot">&lt;-</span> <span class="fu">est_cpue</span>(<span class="at">design =</span> svy_interviews, <span class="at">mode =</span> <span class="st">"ratio_of_means"</span>)</span>
<span id="cb30-3"><a aria-hidden="true" href="#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a aria-hidden="true" href="#cb30-4" tabindex="-1"></a><span class="co"># Standard error is included</span></span>
<span id="cb30-5"><a aria-hidden="true" href="#cb30-5" tabindex="-1"></a>cpue_result<span class="sc">$</span>se</span>
<span id="cb30-6"><a aria-hidden="true" href="#cb30-6" tabindex="-1"></a></span>
<span id="cb30-7"><a aria-hidden="true" href="#cb30-7" tabindex="-1"></a><span class="co"># 95% confidence interval</span></span>
<span id="cb30-8"><a aria-hidden="true" href="#cb30-8" tabindex="-1"></a>cpue_result<span class="sc">$</span>ci_low</span>
<span id="cb30-9"><a aria-hidden="true" href="#cb30-9" tabindex="-1"></a>cpue_result<span class="sc">$</span>ci_high</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
</div>
</section>
<section class="level3" id="roving-mean-of-ratios-with-truncation">
<h3 class="anchored" data-anchor-id="roving-mean-of-ratios-with-truncation">Roving (Mean-of-Ratios with Truncation)</h3>
<p>For mean-of-ratios, variance is straightforward:</p>
<p><span class="math display">\[\text{Var}(\hat{R}_2) = \frac{1}{n} \text{Var}\left(\frac{C_j}{E_j}\right)\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a aria-hidden="true" href="#cb31-1" tabindex="-1"></a><span class="co"># survey::svymean() on the ratio variable</span></span>
<span id="cb31-2"><a aria-hidden="true" href="#cb31-2" tabindex="-1"></a>cpue_roving <span class="ot">&lt;-</span> <span class="fu">est_cpue</span>(<span class="at">design =</span> svy_roving, <span class="at">mode =</span> <span class="st">"mean_of_ratios"</span>)</span>
<span id="cb31-3"><a aria-hidden="true" href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a aria-hidden="true" href="#cb31-4" tabindex="-1"></a><span class="co"># Standard error and CIs included</span></span>
<span id="cb31-5"><a aria-hidden="true" href="#cb31-5" tabindex="-1"></a>cpue_roving<span class="sc">$</span>se</span>
<span id="cb31-6"><a aria-hidden="true" href="#cb31-6" tabindex="-1"></a>cpue_roving<span class="sc">$</span>ci_low</span>
<span id="cb31-7"><a aria-hidden="true" href="#cb31-7" tabindex="-1"></a>cpue_roving<span class="sc">$</span>ci_high</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section class="level2" id="special-considerations">
<h2 class="anchored" data-anchor-id="special-considerations">Special Considerations</h2>
<section class="level3" id="bag-limits">
<h3 class="anchored" data-anchor-id="bag-limits">Bag Limits</h3>
<p><strong>⚠️ CRITICAL WARNING:</strong> Roving surveys can produce <strong>severe negative bias</strong> (underestimation of 20-50%+) when bag limits are low (≤5 fish) and anglers comply by leaving immediately upon reaching the limit.</p>
<p><strong>Problem:</strong> If anglers leave immediately after catching their limit, the roving clerk will encounter <strong>only unsuccessful anglers</strong>, leading to severe underestimation.</p>
<p><strong>Example simulation</strong> (bag limit = 2 fish):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a aria-hidden="true" href="#cb32-1" tabindex="-1"></a>simulate_with_bag_limit <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_reps =</span> <span class="dv">500</span>, <span class="at">bag_limit =</span> <span class="dv">2</span>) {</span>
<span id="cb32-2"><a aria-hidden="true" href="#cb32-2" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>n_reps, <span class="cf">function</span>(rep) {</span>
<span id="cb32-3"><a aria-hidden="true" href="#cb32-3" tabindex="-1"></a>    <span class="co"># Simulate fishing day</span></span>
<span id="cb32-4"><a aria-hidden="true" href="#cb32-4" tabindex="-1"></a>    day <span class="ot">&lt;-</span> <span class="fu">simulate_fishing_day</span>(<span class="at">n_anglers =</span> <span class="dv">100</span>)</span>
<span id="cb32-5"><a aria-hidden="true" href="#cb32-5" tabindex="-1"></a>    true_rate <span class="ot">&lt;-</span> day<span class="sc">$</span>true_population_rate[<span class="dv">1</span>]</span>
<span id="cb32-6"><a aria-hidden="true" href="#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a aria-hidden="true" href="#cb32-7" tabindex="-1"></a>    <span class="co"># Apply bag limit: anglers stop when limit reached</span></span>
<span id="cb32-8"><a aria-hidden="true" href="#cb32-8" tabindex="-1"></a>    day_limited <span class="ot">&lt;-</span> day <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a aria-hidden="true" href="#cb32-9" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb32-10"><a aria-hidden="true" href="#cb32-10" tabindex="-1"></a>        <span class="co"># Time to reach bag limit (exponential waiting time)</span></span>
<span id="cb32-11"><a aria-hidden="true" href="#cb32-11" tabindex="-1"></a>        <span class="at">time_to_limit =</span> <span class="fu">ifelse</span>(catch_rate_true <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb32-12"><a aria-hidden="true" href="#cb32-12" tabindex="-1"></a>                               bag_limit <span class="sc">/</span> catch_rate_true,</span>
<span id="cb32-13"><a aria-hidden="true" href="#cb32-13" tabindex="-1"></a>                               <span class="cn">Inf</span>),</span>
<span id="cb32-14"><a aria-hidden="true" href="#cb32-14" tabindex="-1"></a>        <span class="co"># Actual trip length (stop at limit or planned end, whichever comes first)</span></span>
<span id="cb32-15"><a aria-hidden="true" href="#cb32-15" tabindex="-1"></a>        <span class="at">actual_trip_length =</span> <span class="fu">pmin</span>(trip_length, time_to_limit),</span>
<span id="cb32-16"><a aria-hidden="true" href="#cb32-16" tabindex="-1"></a>        <span class="co"># Actual catch (capped at bag limit)</span></span>
<span id="cb32-17"><a aria-hidden="true" href="#cb32-17" tabindex="-1"></a>        <span class="at">actual_catch =</span> <span class="fu">pmin</span>(completed_catch, bag_limit),</span>
<span id="cb32-18"><a aria-hidden="true" href="#cb32-18" tabindex="-1"></a>        <span class="co"># Did angler reach bag limit before planned trip end?</span></span>
<span id="cb32-19"><a aria-hidden="true" href="#cb32-19" tabindex="-1"></a>        <span class="at">reached_limit =</span> (time_to_limit <span class="sc">&lt;</span> trip_length)</span>
<span id="cb32-20"><a aria-hidden="true" href="#cb32-20" tabindex="-1"></a>      )</span>
<span id="cb32-21"><a aria-hidden="true" href="#cb32-21" tabindex="-1"></a></span>
<span id="cb32-22"><a aria-hidden="true" href="#cb32-22" tabindex="-1"></a>    <span class="co"># Roving interviews can only encounter anglers still on-site</span></span>
<span id="cb32-23"><a aria-hidden="true" href="#cb32-23" tabindex="-1"></a>    <span class="co"># Those who reached bag limit before their planned trip end have already left</span></span>
<span id="cb32-24"><a aria-hidden="true" href="#cb32-24" tabindex="-1"></a>    <span class="co"># Only those who haven't reached the limit OR reached it at/after planned end are available</span></span>
<span id="cb32-25"><a aria-hidden="true" href="#cb32-25" tabindex="-1"></a>    still_fishing <span class="ot">&lt;-</span> day_limited <span class="sc">%&gt;%</span></span>
<span id="cb32-26"><a aria-hidden="true" href="#cb32-26" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span>reached_limit)</span>
<span id="cb32-27"><a aria-hidden="true" href="#cb32-27" tabindex="-1"></a></span>
<span id="cb32-28"><a aria-hidden="true" href="#cb32-28" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(still_fishing) <span class="sc">&gt;</span> <span class="dv">10</span>) {</span>
<span id="cb32-29"><a aria-hidden="true" href="#cb32-29" tabindex="-1"></a>      <span class="co"># Sample from those still fishing</span></span>
<span id="cb32-30"><a aria-hidden="true" href="#cb32-30" tabindex="-1"></a>      sample_data <span class="ot">&lt;-</span> <span class="fu">sample_roving_interviews</span>(still_fishing, <span class="at">n_interviews =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-31"><a aria-hidden="true" href="#cb32-31" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">catch =</span> catch_at_interview, <span class="at">effort =</span> time_at_interview) <span class="sc">%&gt;%</span></span>
<span id="cb32-32"><a aria-hidden="true" href="#cb32-32" tabindex="-1"></a>        <span class="fu">filter</span>(effort <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb32-33"><a aria-hidden="true" href="#cb32-33" tabindex="-1"></a></span>
<span id="cb32-34"><a aria-hidden="true" href="#cb32-34" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(sample_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-35"><a aria-hidden="true" href="#cb32-35" tabindex="-1"></a>        r2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(sample_data<span class="sc">$</span>catch <span class="sc">/</span> sample_data<span class="sc">$</span>effort)</span>
<span id="cb32-36"><a aria-hidden="true" href="#cb32-36" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">rep =</span> rep, <span class="at">true_rate =</span> true_rate, <span class="at">estimated_rate =</span> r2,</span>
<span id="cb32-37"><a aria-hidden="true" href="#cb32-37" tabindex="-1"></a>                     <span class="at">bag_limit =</span> bag_limit))</span>
<span id="cb32-38"><a aria-hidden="true" href="#cb32-38" tabindex="-1"></a>      }</span>
<span id="cb32-39"><a aria-hidden="true" href="#cb32-39" tabindex="-1"></a>    }</span>
<span id="cb32-40"><a aria-hidden="true" href="#cb32-40" tabindex="-1"></a></span>
<span id="cb32-41"><a aria-hidden="true" href="#cb32-41" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">rep =</span> rep, <span class="at">true_rate =</span> true_rate, <span class="at">estimated_rate =</span> <span class="cn">NA</span>, <span class="at">bag_limit =</span> bag_limit)</span>
<span id="cb32-42"><a aria-hidden="true" href="#cb32-42" tabindex="-1"></a>  })</span>
<span id="cb32-43"><a aria-hidden="true" href="#cb32-43" tabindex="-1"></a>}</span>
<span id="cb32-44"><a aria-hidden="true" href="#cb32-44" tabindex="-1"></a></span>
<span id="cb32-45"><a aria-hidden="true" href="#cb32-45" tabindex="-1"></a>bag_limit_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb32-46"><a aria-hidden="true" href="#cb32-46" tabindex="-1"></a>  <span class="fu">simulate_with_bag_limit</span>(<span class="at">bag_limit =</span> <span class="dv">2</span>),</span>
<span id="cb32-47"><a aria-hidden="true" href="#cb32-47" tabindex="-1"></a>  <span class="fu">simulate_with_bag_limit</span>(<span class="at">bag_limit =</span> <span class="dv">5</span>),</span>
<span id="cb32-48"><a aria-hidden="true" href="#cb32-48" tabindex="-1"></a>  <span class="fu">simulate_with_bag_limit</span>(<span class="at">bag_limit =</span> <span class="dv">10</span>)</span>
<span id="cb32-49"><a aria-hidden="true" href="#cb32-49" tabindex="-1"></a>)</span>
<span id="cb32-50"><a aria-hidden="true" href="#cb32-50" tabindex="-1"></a></span>
<span id="cb32-51"><a aria-hidden="true" href="#cb32-51" tabindex="-1"></a>bag_limit_summary <span class="ot">&lt;-</span> bag_limit_results <span class="sc">%&gt;%</span></span>
<span id="cb32-52"><a aria-hidden="true" href="#cb32-52" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(estimated_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb32-53"><a aria-hidden="true" href="#cb32-53" tabindex="-1"></a>  <span class="fu">group_by</span>(bag_limit) <span class="sc">%&gt;%</span></span>
<span id="cb32-54"><a aria-hidden="true" href="#cb32-54" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb32-55"><a aria-hidden="true" href="#cb32-55" tabindex="-1"></a>    <span class="at">true_rate =</span> <span class="fu">mean</span>(true_rate),</span>
<span id="cb32-56"><a aria-hidden="true" href="#cb32-56" tabindex="-1"></a>    <span class="at">mean_estimate =</span> <span class="fu">mean</span>(estimated_rate),</span>
<span id="cb32-57"><a aria-hidden="true" href="#cb32-57" tabindex="-1"></a>    <span class="at">bias =</span> <span class="fu">mean</span>(estimated_rate <span class="sc">-</span> true_rate),</span>
<span id="cb32-58"><a aria-hidden="true" href="#cb32-58" tabindex="-1"></a>    <span class="at">pct_bias =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>((estimated_rate <span class="sc">-</span> true_rate) <span class="sc">/</span> true_rate)</span>
<span id="cb32-59"><a aria-hidden="true" href="#cb32-59" tabindex="-1"></a>  )</span>
<span id="cb32-60"><a aria-hidden="true" href="#cb32-60" tabindex="-1"></a></span>
<span id="cb32-61"><a aria-hidden="true" href="#cb32-61" tabindex="-1"></a>bag_limit_summary <span class="sc">%&gt;%</span></span>
<span id="cb32-62"><a aria-hidden="true" href="#cb32-62" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Roving Bias Under Different Bag Limits"</span>)</span></code></pre></div><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Roving Bias Under Different Bag Limits</caption>
<thead>
<tr class="header">
<th style="text-align: right;">bag_limit</th>
<th style="text-align: right;">true_rate</th>
<th style="text-align: right;">mean_estimate</th>
<th style="text-align: right;">bias</th>
<th style="text-align: right;">pct_bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.010</td>
<td style="text-align: right;">0.341</td>
<td style="text-align: right;">-1.668</td>
<td style="text-align: right;">-83.017</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2.001</td>
<td style="text-align: right;">0.655</td>
<td style="text-align: right;">-1.346</td>
<td style="text-align: right;">-67.286</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">2.003</td>
<td style="text-align: right;">1.021</td>
<td style="text-align: right;">-0.982</td>
<td style="text-align: right;">-49.014</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Recommendation:</strong> If bag limits are low (≤5 fish) and compliance is high, <strong>use access point interviews</strong> instead of roving.</p>
</section>
<section class="level3" id="nonstationary-catch-rates">
<h3 class="anchored" data-anchor-id="nonstationary-catch-rates">Nonstationary Catch Rates</h3>
<p>If catch rates change systematically during trips (e.g., learning curve, time-of-day effects), roving interviews may be biased.</p>
<p><strong>Check this by:</strong></p>
<ol type="1">
<li>Comparing incomplete-trip catch rates to complete-trip catch rates</li>
<li>Looking for patterns in catch rate vs. time-of-day</li>
</ol>
<p><strong>If nonstationary:</strong> Consider access point interviews or model the time-varying catch rate.</p>
</section>
</section>
<section class="level2" id="summary-practical-guidelines">
<h2 class="anchored" data-anchor-id="summary-practical-guidelines">Summary: Practical Guidelines</h2>
<section class="level3" id="decision-rules">
<h3 class="anchored" data-anchor-id="decision-rules">Decision Rules</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 19%"/>
<col style="width: 24%"/>
<col style="width: 33%"/>
<col style="width: 22%"/>
</colgroup>
<thead>
<tr class="header">
<th>Survey Type</th>
<th>Interview Type</th>
<th>Recommended Estimator</th>
<th>Function Call</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Access point</td>
<td>Complete trips</td>
<td>Ratio-of-means (R₁)</td>
<td><code>est_cpue(..., mode = "ratio_of_means")</code></td>
</tr>
<tr class="even">
<td>Roving</td>
<td>Incomplete trips</td>
<td>Mean-of-ratios (R₂) with truncation</td>
<td><code>est_cpue(..., mode = "mean_of_ratios")</code> + filter short trips</td>
</tr>
<tr class="odd">
<td>Complemented (aerial-access)</td>
<td>Complete trips</td>
<td>Ratio-of-means (R₁)</td>
<td><code>est_cpue(..., mode = "ratio_of_means")</code></td>
</tr>
<tr class="even">
<td>Complemented (aerial-roving)</td>
<td>Incomplete trips</td>
<td>Mean-of-ratios (R₂) with truncation</td>
<td><code>est_cpue(..., mode = "mean_of_ratios")</code> + filter</td>
</tr>
</tbody>
</table>
</section>
<section class="level3" id="pre-processing-checklist">
<h3 class="anchored" data-anchor-id="pre-processing-checklist">Pre-processing Checklist</h3>
<p><strong>For ALL surveys:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"/>Check for missing data in catch and effort</label></li>
<li><label><input type="checkbox"/>Verify effort &gt; 0 for all interviews</label></li>
<li><label><input type="checkbox"/>Check for outliers (data entry errors)</label></li>
</ul>
<p><strong>For ROVING surveys specifically:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"/>Truncate short trips (&lt; 20-30 minutes)</label></li>
<li><label><input type="checkbox"/>Check bag limit compliance (may cause bias)</label></li>
<li><label><input type="checkbox"/>Verify catch rate stationarity (if possible)</label></li>
</ul>
</section>
<section class="level3" id="variance-estimation-checklist">
<h3 class="anchored" data-anchor-id="variance-estimation-checklist">Variance Estimation Checklist</h3>
<ul class="task-list">
<li><label><input type="checkbox"/>Use proper survey weights in <code>svydesign()</code></label></li>
<li><label><input type="checkbox"/>Include stratification variables</label></li>
<li><label><input type="checkbox"/>Use <code>svyratio()</code> for ratio-of-means</label></li>
<li><label><input type="checkbox"/>Use <code>svymean()</code> on catch/effort ratio for mean-of-ratios</label></li>
<li><label><input type="checkbox"/>Report standard errors and confidence intervals</label></li>
</ul>
</section>
</section>
<section class="level2" id="references">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><p><strong>Pollock, K.H., Hoenig, J.M., Jones, C.M., Robson, D.S., &amp; Greene, C.J. (1997).</strong> Catch rate estimation for roving and access point surveys. <em>North American Journal of Fisheries Management</em>, 17(1), 11-19.</p></li>
<li><p><strong>Rasmussen, P.W., Staggs, M.D., Beard, T.D., &amp; Newman, S.P. (1998).</strong> Bias and confidence interval coverage of creel survey estimators evaluated by simulation. <em>Transactions of the American Fisheries Society</em>, 127(3), 469-480.</p></li>
<li><p><strong>Jones, C.M., Robson, D.S., Lakkis, H.D., &amp; Kressel, J. (1995).</strong> Properties of catch rates used in analysis of angler surveys. <em>Transactions of the American Fisheries Society</em>, 124(6), 911-928.</p></li>
<li><p><strong>Lumley, T. (2004).</strong> Analysis of complex survey samples. <em>Journal of Statistical Software</em>, 9(1), 1-19.</p></li>
</ul>
</section>
<section class="level2" id="conclusion">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The choice between ratio-of-means and mean-of-ratios depends fundamentally on your <strong>survey design</strong>:</p>
<ul>
<li><strong>Access point interviews</strong> → Use <strong>ratio-of-means</strong></li>
<li><strong>Roving interviews</strong> → Use <strong>mean-of-ratios with truncation</strong></li>
</ul>
<p>The <code>tidycreel</code> package implements both estimators with proper variance estimation through the <code>survey</code> package. By following the decision rules in this vignette, you can ensure your catch rate estimates are unbiased and your confidence intervals have correct coverage.</p>
</section>
</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
</body>
